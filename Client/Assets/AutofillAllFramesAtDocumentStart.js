(()=>{"use strict";const e=Object.freeze({platform:"ios",prefs:{"extensions.formautofill.creditCards.heuristics.mode":1,"extensions.formautofill.creditCards.heuristics.fathom.confidenceThreshold":.5,"extensions.formautofill.creditCards.heuristics.fathom.highConfidenceThreshold":.95,"extensions.formautofill.creditCards.heuristics.fathom.testConfidence":0,"extensions.formautofill.creditCards.heuristics.fathom.types":"cc-number,cc-name","extensions.formautofill.loglevel":"Warn","extensions.formautofill.firstTimeUse":!0,"extensions.formautofill.addresses.supported":"off","extensions.formautofill.creditCards.supported":"detect","browser.search.region":"US","extensions.formautofill.creditCards.supportedCountries":"US,CA,GB,FR,DE","extensions.formautofill.addresses.enabled":!1,"extensions.formautofill.addresses.capture.enabled":!1,"extensions.formautofill.addresses.capture.v2.enabled":!1,"extensions.formautofill.addresses.supportedCountries":"","extensions.formautofill.creditCards.enabled":!0,"extensions.formautofill.reauth.enabled":!0,"extensions.formautofill.creditCards.hideui":!1,"extensions.formautofill.supportRTL":!1,"extensions.formautofill.creditCards.ignoreAutocompleteOff":!0,"extensions.formautofill.addresses.ignoreAutocompleteOff":!0,"extensions.formautofill.heuristics.enabled":!0,"extensions.formautofill.section.enabled":!0},validAutocompleteFields:["off","on","name","honorific-prefix","given-name","additional-name","family-name","honorific-suffix","nickname","email","username","new-password","current-password","one-time-code","organization-title","organization","street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code","cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type","transaction-currency","transaction-amount","language","bday","bday-day","bday-month","bday-year","sex","tel","tel-country-code","tel-national","tel-area-code","tel-local","tel-extension","impp","url","photo"]});HTMLSelectElement.isInstance=e=>e instanceof HTMLSelectElement,HTMLInputElement.isInstance=e=>e instanceof HTMLInputElement,HTMLFormElement.isInstance=e=>e instanceof HTMLFormElement,ShadowRoot.isInstance=e=>e instanceof ShadowRoot,HTMLElement.prototype.ownerGlobal=window,HTMLInputElement.prototype.setUserInput=function(e){this.value=e,this.dispatchEvent(new Event("input",{bubbles:!0}))},window.Cu=class{static getWeakReference(e){const t=new WeakRef(e);return{get:()=>t.deref()}}},HTMLElement.prototype.getAutocompleteInfo=function(){const t=this.getAttribute("autocomplete");return{fieldName:e.validAutocompleteFields.includes(t)?t:""}};const t=e=>new Proxy(e,{get(e,t){if(!Object.keys(e).includes(t))throw new Error(`Not implemented: ${t} doesn't exist in mocked object `);return Reflect.get(...arguments)}}),r=t({defineLazyGetter:(e,t,r)=>{e[t]=r?.()},defineLazyPreferenceGetter:(t,r,n,i=null,a=null,s=(e=>e))=>{if(!Object.keys(e.prefs).includes(n))throw Error(`Pref ${n} is not defined.`);t[r]=s(e.prefs[n]??i)}}),n=t({home:"US"}),i=t({ensureLoggedIn:()=>!0}),a=t({intl:t({getAvailableLocaleDisplayNames:()=>[],getRegionDisplayNames:()=>[]}),locale:t({isAppLocaleRTL:!1}),prefs:t({prefIsLocked:()=>!1}),strings:t({createBundle:()=>t({GetStringFromName:()=>"",formatStringFromName:()=>""})}),uuid:t({generateUUID:()=>""})});window.Services=a;const s=t({removeManuallyManagedState:()=>{},addManuallyManagedState:()=>{}});window.windowUtils=s;const l=t({recordFormInteractionEvent:()=>{},recordDetectedSectionCount:()=>{}}),o="extensions.formautofill.firstTimeUse",d="extensions.formautofill.addresses.enabled",c="extensions.formautofill.addresses.capture.enabled",u="extensions.formautofill.addresses.capture.v2.enabled",m="extensions.formautofill.creditCards.enabled",h="extensions.formautofill.creditCards.ignoreAutocompleteOff",p="extensions.formautofill.addresses.ignoreAutocompleteOff",f={ENABLED_AUTOFILL_ADDRESSES_PREF:d,ENABLED_AUTOFILL_ADDRESSES_CAPTURE_PREF:c,ENABLED_AUTOFILL_ADDRESSES_CAPTURE_V2_PREF:u,ENABLED_AUTOFILL_CREDITCARDS_PREF:m,ENABLED_AUTOFILL_CREDITCARDS_REAUTH_PREF:"extensions.formautofill.reauth.enabled",ADDRESSES_FIRST_TIME_USE_PREF:o,AUTOFILL_CREDITCARDS_AUTOCOMPLETE_OFF_PREF:h,AUTOFILL_ADDRESSES_AUTOCOMPLETE_OFF_PREF:p,get DEFAULT_REGION(){return n.home||"US"},_isSupportedRegion:(e,t)=>"on"==e||"detect"==e&&!(!f.supportRTL&&Services.locale.isAppLocaleRTL)&&t.includes(f.browserSearchRegion),isAutofillAddressesAvailableInCountry:e=>f._addressAutofillSupportedCountries.includes(e),get isAutofillEnabled(){return this.isAutofillAddressesEnabled||this.isAutofillCreditCardsEnabled},get isAutofillCreditCardsAvailable(){return this._isSupportedRegion(f._isAutofillCreditCardsAvailable,f._creditCardAutofillSupportedCountries)},get isAutofillAddressesAvailable(){return this._isSupportedRegion(f._isAutofillAddressesAvailable,f._addressAutofillSupportedCountries)},get isAutofillCreditCardsEnabled(){return this.isAutofillCreditCardsAvailable&&f._isAutofillCreditCardsEnabled},get isAutofillCreditCardsLocked(){return Services.prefs.prefIsLocked(m)},get isAutofillAddressesEnabled(){return this.isAutofillAddressesAvailable&&f._isAutofillAddressesEnabled},get isAutofillAddressesLocked(){return Services.prefs.prefIsLocked(d)},defineLogGetter(e,t){e.debug=function(){"debug"==f.logLevel.toLowerCase()&&this.log.debug(...arguments)};let{ConsoleAPI:r}=ChromeUtils.importESModule("resource://gre/modules/Console.sys.mjs");return new r({maxLogLevelPref:"extensions.formautofill.loglevel",prefix:t})}};r.defineLazyPreferenceGetter(f,"browserSearchRegion","browser.search.region",f.DEFAULT_REGION),r.defineLazyPreferenceGetter(f,"logLevel","extensions.formautofill.loglevel","Warn"),r.defineLazyPreferenceGetter(f,"_isAutofillAddressesAvailable","extensions.formautofill.addresses.supported"),r.defineLazyPreferenceGetter(f,"_isAutofillAddressesEnabled",d),r.defineLazyPreferenceGetter(f,"isAutofillAddressesCaptureEnabled",c),r.defineLazyPreferenceGetter(f,"isAutofillAddressesCaptureV2Enabled",u),r.defineLazyPreferenceGetter(f,"_isAutofillCreditCardsAvailable","extensions.formautofill.creditCards.supported"),r.defineLazyPreferenceGetter(f,"_isAutofillCreditCardsEnabled",m),r.defineLazyPreferenceGetter(f,"isAutofillCreditCardsHideUI","extensions.formautofill.creditCards.hideui"),r.defineLazyPreferenceGetter(f,"isAutofillAddressesFirstTimeUse",o),r.defineLazyPreferenceGetter(f,"_addressAutofillSupportedCountries","extensions.formautofill.addresses.supportedCountries",null,(e=>e.split(","))),r.defineLazyPreferenceGetter(f,"_creditCardAutofillSupportedCountries","extensions.formautofill.creditCards.supportedCountries",null,null,(e=>e.split(","))),r.defineLazyPreferenceGetter(f,"supportRTL","extensions.formautofill.supportRTL"),r.defineLazyPreferenceGetter(f,"creditCardsAutocompleteOff",h),r.defineLazyPreferenceGetter(f,"addressesAutocompleteOff",p),r.defineLazyGetter(f,"countries",(()=>{let e=Services.intl.getAvailableLocaleDisplayNames("region"),t=Services.intl.getRegionDisplayNames(void 0,e),r=new Map;for(let n=0;n<e.length;n++)r.set(e[n].toUpperCase(),t[n]);return r})),f.defineLogGetter=(e,t)=>({info:()=>{},error:()=>{},warn:()=>{},debug:()=>{}});const g=Object.freeze(["amex","cartebancaire","diners","discover","jcb","mastercard","mir","unionpay","visa"]),y={"american express":"amex","master card":"mastercard","union pay":"unionpay"},x=[{type:"amex",start:34,end:34,len:15},{type:"amex",start:37,end:37,len:15},{type:"cartebancaire",start:4035,end:4035,len:16},{type:"cartebancaire",start:4360,end:4360,len:16},{type:"diners",start:300,end:305,len:[14,19]},{type:"diners",start:3095,end:3095,len:[14,19]},{type:"diners",start:36,end:36,len:[14,19]},{type:"diners",start:38,end:39,len:[14,19]},{type:"discover",start:6011,end:6011,len:[16,19]},{type:"discover",start:622126,end:622925,len:[16,19]},{type:"discover",start:624e3,end:626999,len:[16,19]},{type:"discover",start:628200,end:628899,len:[16,19]},{type:"discover",start:64,end:65,len:[16,19]},{type:"jcb",start:3528,end:3589,len:[16,19]},{type:"mastercard",start:2221,end:2720,len:16},{type:"mastercard",start:51,end:55,len:16},{type:"mir",start:2200,end:2204,len:16},{type:"unionpay",start:62,end:62,len:[16,19]},{type:"unionpay",start:81,end:81,len:[16,19]},{type:"visa",start:4,end:4,len:16}].sort(((e,t)=>t.start-e.start));class b{constructor({name:e,number:t,expirationString:r,expirationMonth:n,expirationYear:i,network:a,ccv:s,encryptedNumber:l}){this._name=e,this._unmodifiedNumber=t,this._encryptedNumber=l,this._ccv=s,this.number=t;let{month:o,year:d}=b.normalizeExpiration({expirationString:r,expirationMonth:n,expirationYear:i});this._expirationMonth=o,this._expirationYear=d,this.network=a}set name(e){this._name=e}set expirationMonth(e){this._expirationMonth=void 0!==e?b.normalizeExpirationMonth(e):void 0}get expirationMonth(){return this._expirationMonth}set expirationYear(e){this._expirationYear=void 0!==e?b.normalizeExpirationYear(e):void 0}get expirationYear(){return this._expirationYear}set expirationString(e){let{month:t,year:r}=b.parseExpirationString(e);this.expirationMonth=t,this.expirationYear=r}set ccv(e){this._ccv=e}get number(){return this._number}set number(e){if(e){let t=b.normalizeCardNumber(e);t=t.match(/^\d{12,}$/)?t:"",this._number=t}else this._number="";if(e&&!this.isValidNumber())throw this._number="",new Error("Invalid credit card number")}get network(){return this._network}set network(e){this._network=e||void 0}isValidNumber(){if(!this._number)return!1;let e=this._number.replace(/[\-\s]/g,""),t=e.length;if(t<12||t>19)return!1;if(!/^\d+$/.test(e))return!1;let r=0;for(let n=0;n<t;n++){let i=parseInt(e[t-n-1],10);n%2==1&&(i*=2,i>9&&(i-=9)),r+=i}return r%10==0}static normalizeCardNumber(e){return e?e.replace(/[\-\s]/g,""):null}static getType(e){if(!e)return null;for(let t=0;t<x.length;t++){const r=x[t];if("number"==typeof r.len){if(r.len!=e.length)continue}else if(e.length<r.len[0]||e.length>r.len[1])continue;const n=Math.floor(Math.log10(r.start))+1,i=parseInt(e.substring(0,n),10);if(i>=r.start&&i<=r.end)return r.type}return null}static getNetworkFromName(e){if(!e)return null;let t=e.trim().toLowerCase().normalize("NFKC");if(g.includes(t))return t;for(let e in y)if(t.includes(e))return y[e];return null}isValid(){if(!this.isValidNumber())return!1;let e=new Date,t=e.getFullYear();if(this._expirationYear>t)return!0;let r=e.getMonth()+1;return this._expirationYear==t&&this._expirationMonth>=r}get maskedNumber(){return b.getMaskedNumber(this._number)}get longMaskedNumber(){return b.getLongMaskedNumber(this._number)}static getLabelInfo({number:e,name:t,month:r,year:n,type:i}){let a=["number"];return t&&a.push("name"),r&&n&&a.push("expiration"),{id:`credit-card-label-${a.join("-")}-2`,args:{number:b.getMaskedNumber(e),name:t,month:r?.toString(),year:n?.toString(),type:i}}}static getLabel({number:e,name:t}){let r=[];return e&&r.push(b.getMaskedNumber(e)),t&&r.push(t),r.join(", ")}static normalizeExpirationMonth(e){if(e=parseInt(e,10),!(isNaN(e)||e<1||e>12))return e}static normalizeExpirationYear(e){if(e=parseInt(e,10),!(isNaN(e)||e<0))return e<100&&(e+=2e3),e}static parseExpirationString(e){let t=[{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/},{regex:/(?:^|\D)(\d{4})[-/](\d{1,2})(?!\d)/,yearIndex:0,monthIndex:1},{regex:/(?:^|\D)(\d{1,2})[-/](\d{4})(?!\d)/,yearIndex:1,monthIndex:0},{regex:/(?:^|\D)(\d{1,2})[-/](\d{1,2})(?!\d)/},{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/}];e=e.replaceAll(" ","");for(let r of t){let t,n,i=r.regex.exec(e);if(!i)continue;const a=[parseInt(i[1],10),parseInt(i[2],10)];if(r.yearIndex&&r.monthIndex?(t=a[r.yearIndex],n=a[r.monthIndex]):(n=a[0],n>12?(t=a[0],n=a[1]):t=a[1]),n>=1&&n<=12&&(t<100||t>2e3))return{month:n,year:t}}return{month:void 0,year:void 0}}static normalizeExpiration({expirationString:e,expirationMonth:t,expirationYear:r}){let n={};return!e||t&&r||(n=b.parseExpirationString(e)),{month:b.normalizeExpirationMonth(n.month||t),year:b.normalizeExpirationYear(n.year||r)}}static formatMaskedNumber(e){return{affix:"****",label:e.replace(/^\**/,"")}}static getCreditCardLogo(e){const t="chrome://formautofill/content/",r=t+"third-party/";switch(e){case"amex":return r+"cc-logo-amex.png";case"cartebancaire":return r+"cc-logo-cartebancaire.png";case"diners":return r+"cc-logo-diners.svg";case"discover":return r+"cc-logo-discover.png";case"jcb":return r+"cc-logo-jcb.svg";case"mastercard":return r+"cc-logo-mastercard.svg";case"mir":return r+"cc-logo-mir.svg";case"unionpay":return r+"cc-logo-unionpay.svg";case"visa":return r+"cc-logo-visa.svg";default:return t+"icon-credit-card-generic.svg"}}static getMaskedNumber(e){return"*".repeat(4)+" "+e.substr(-4)}static getLongMaskedNumber(e){return"*".repeat(e.length-4)+e.substr(-4)}static isValidNumber(e){try{new b({number:e})}catch(e){return!1}return!0}static isValidNetwork(e){return g.includes(e)}static getSupportedNetworks(){return g}static getNetworkL10nId(e){return this.isValidNetwork(e)?`autofill-card-network-${e}`:null}}var E={NAME_PREFIXES:["1lt","1st","2lt","2nd","3rd","admiral","capt","captain","col","cpt","dr","gen","general","lcdr","lt","ltc","ltg","ltjg","maj","major","mg","mr","mrs","ms","pastor","prof","rep","reverend","rev","sen","st"],NAME_SUFFIXES:["b.a","ba","d.d.s","dds","i","ii","iii","iv","ix","jr","m.a","m.d","ma","md","ms","ph.d","phd","sr","v","vi","vii","viii","x"],FAMILY_NAME_PREFIXES:["d'","de","del","der","di","la","le","mc","san","st","ter","van","von"],COMMON_CJK_MULTI_CHAR_SURNAMES:["남궁","사공","서문","선우","제갈","황보","독고","망절","欧阳","令狐","皇甫","上官","司徒","诸葛","司马","宇文","呼延","端木","張簡","歐陽","諸葛","申屠","尉遲","司馬","軒轅","夏侯"],KOREAN_MULTI_CHAR_SURNAMES:["강전","남궁","독고","동방","망절","사공","서문","선우","소봉","어금","장곡","제갈","황목","황보"],WHITESPACE:["\t","\n","\v","\f","\r"," ",""," "," "," "," "," "," "," "," "," "," "," "," "," ","\u2028","\u2029"," "," ","　"],MIDDLE_DOT:["・","·"],CJK_RANGE:["ᄀ-ᇿ","぀-ゟ","゠-ヿ","ㄅ-ㄬ","㄰-㆏","ㇰ-ㇿ","㈀-㋿","㐀-䶿","一-鿿","ꥠ-꥿","가-힯","ힰ-퟿","＀-￯"],HANGUL_RANGE:["ᄀ-ᇿ","㄰-㆏","ꥠ-꥿","가-힯","ힰ-퟿"],_dataLoaded:!1,_containsString(e,t){let r=t.replace(/\.$/,"").toLowerCase();return e.includes(r)},_stripPrefixes(e){for(let t in e)if(!this._containsString(this.NAME_PREFIXES,e[t]))return e.slice(t);return[]},_stripSuffixes(e){for(let t=e.length-1;t>=0;t--)if(!this._containsString(this.NAME_SUFFIXES,e[t]))return e.slice(0,t+1);return[]},_isCJKName(e){if(!e)return!1;let t=!1,r=0;for(let n of e){let e=this.MIDDLE_DOT.includes(n),i=!e&&this.reCJK.test(n);if(!i&&!e&&!this.WHITESPACE.includes(n))return!1;i&&!t&&r++,t=i}return r>0&&r<3},_splitCJKName(e){let t=new RegExp("^["+this.HANGUL_RANGE.join("")+this.WHITESPACE.join("")+"]+$","u"),r={given:"",middle:"",family:""};if(1==e.length){let n=e[0],i=0;i=(t.test(n)&&n.length>3?this.KOREAN_MULTI_CHAR_SURNAMES:this.COMMON_CJK_MULTI_CHAR_SURNAMES).some((e=>n.startsWith(e)))?2:1,r.family=n.substr(0,i),r.given=n.substr(i)}else{if(2!=e.length)return null;r.family=e[0],r.given=e[1]}return r},init(){this._dataLoaded||(this._dataLoaded=!0,this.reCJK=new RegExp("["+this.CJK_RANGE.join("")+"]","u"))},splitName(e){let t={given:"",middle:"",family:""};if(!e)return t;let r=e.trim().split(/[ ,\u3000\u30FB\u00B7]+/);if(r=this._stripPrefixes(r),this._isCJKName(e)){let e=this._splitCJKName(r);if(e)return e}if(r.length>2&&(r=this._stripSuffixes(r)),!r.length)return t.given=e,t;if(1==r.length)return t.given=r[0],t;let n=[r.pop()];for(;r.length;){let e=r[r.length-1];if(!this._containsString(this.FAMILY_NAME_PREFIXES,e))break;n.unshift(e),r.pop()}return t.family=n.join(" "),r.length>=2&&(t.middle=r.pop()),t.given=r.join(" "),t},joinNameParts({given:e,middle:t,family:r}){return this._isCJKName(e)&&this._isCJKName(r)&&!t?r+e:[e,t,r].filter((e=>e&&e.length)).join(" ")}};let _;E.init();const S="resource://autofill/addressmetadata/",F=["text","email","tel","number","month"];let L={_dataLoaded:{country:!1,level1:new Set},_loadScripts(e){let t={},r={};try{t=_.loadDataFromScript(e+"addressReferences.js"),r=_.loadDataFromScript(e+"addressReferencesExt.js")}catch(e){return t}if(r.addressDataExt)for(let e in r.addressDataExt){let n=t.addressData[e];n||(n=t.addressData[e]={}),Object.assign(n,r.addressDataExt[e])}return t},_parse(e){if(!e)return null;const t=["languages","sub_keys","sub_isoids","sub_names","sub_lnames"];for(let r of t)if(e[r]){if(Array.isArray(e[r]))return e;e[r]=e[r].split("~")}return e},_loadData(e,t=null){return this._dataLoaded.country||(this._addressData=this._loadScripts(S).addressData,this._dataLoaded.country=!0),t?(this._dataLoaded.level1.has(e)||(Object.assign(this._addressData,this._loadScripts(`${S}${e}/`).addressData),this._dataLoaded.level1.add(e)),this._parse(this._addressData[`data/${e}/${t}`])):this._parse(this._addressData[`data/${e}`])},getData(e,t=null){let r=this._loadData(e,t);if(!r)return null;let n=this._parse(this._addressData[`data/${e}`]),i=[];return n.languages&&(i=n.languages.filter((e=>e!==n.lang)).map((e=>this._parse(this._addressData[`${r.id}--${e}`])))),{defaultLocale:r,locales:i}}};_={get AUTOFILL_FIELDS_THRESHOLD(){return 3},ADDRESSES_COLLECTION_NAME:"addresses",CREDITCARDS_COLLECTION_NAME:"creditCards",MANAGE_ADDRESSES_L10N_IDS:["autofill-add-new-address-title","autofill-manage-addresses-title"],EDIT_ADDRESS_L10N_IDS:["autofill-address-given-name","autofill-address-additional-name","autofill-address-family-name","autofill-address-organization","autofill-address-street","autofill-address-state","autofill-address-province","autofill-address-city","autofill-address-country","autofill-address-zip","autofill-address-postal-code","autofill-address-email","autofill-address-tel"],MANAGE_CREDITCARDS_L10N_IDS:["autofill-add-new-card-title","autofill-manage-credit-cards-title"],EDIT_CREDITCARD_L10N_IDS:["autofill-card-number","autofill-card-name-on-card","autofill-card-expires-month","autofill-card-expires-year","autofill-card-network"],MAX_FIELD_VALUE_LENGTH:200,FIELD_STATES:{NORMAL:"NORMAL",AUTO_FILLED:"AUTO_FILLED",PREVIEW:"PREVIEW"},SECTION_TYPES:{ADDRESS:"address",CREDIT_CARD:"creditCard"},_fieldNameInfo:{name:"name","given-name":"name","additional-name":"name","family-name":"name",organization:"organization","street-address":"address","address-line1":"address","address-line2":"address","address-line3":"address","address-level1":"address","address-level2":"address","postal-code":"address",country:"address","country-name":"address",tel:"tel","tel-country-code":"tel","tel-national":"tel","tel-area-code":"tel","tel-local":"tel","tel-local-prefix":"tel","tel-local-suffix":"tel","tel-extension":"tel",email:"email","cc-name":"creditCard","cc-given-name":"creditCard","cc-additional-name":"creditCard","cc-family-name":"creditCard","cc-number":"creditCard","cc-exp-month":"creditCard","cc-exp-year":"creditCard","cc-exp":"creditCard","cc-type":"creditCard"},_collators:{},_reAlternativeCountryNames:{},isAddressField(e){return!!this._fieldNameInfo[e]&&!this.isCreditCardField(e)},isCreditCardField(e){return"creditCard"==this._fieldNameInfo[e]},isCCNumber:e=>b.isValidNumber(e),ensureLoggedIn(e){return i.ensureLoggedIn(!(!this._reauthEnabledByUser||!e)&&e)},getCreditCardNetworks:()=>b.getSupportedNetworks(),getCategoryFromFieldName(e){return this._fieldNameInfo[e]},getCategoriesFromFieldNames(e){let t=new Set;for(let r of e){let e=this.getCategoryFromFieldName(r);e&&t.add(e)}return Array.from(t)},getAddressSeparator:()=>" ",getAddressLabel(e){let t=["name","-moz-street-address-one-line","address-level3","address-level2","organization","address-level1","country-name","postal-code","tel","email"],r=[];(e={...e})["street-address"]&&(e["-moz-street-address-one-line"]=this.toOneLineAddress(e["street-address"])),"name"in e||(e.name=E.joinNameParts({given:e["given-name"],middle:e["additional-name"],family:e["family-name"]}));for(const n of t){let t=e[n];t&&r.push(t)}return r.join(", ")},_toStreetAddressParts(e,t="\n"){let r="string"==typeof e?e.split(t):e;return Array.isArray(r)?r.map((e=>e?e.trim():"")).filter((e=>e)):[]},toOneLineAddress(e,t="\n"){return this._toStreetAddressParts(e,t).join(this.getAddressSeparator())},compareStreetAddress(e,t,r,n="\n"){let i=this._toStreetAddressParts(e,n).map((e=>e.replace(/\s/g,""))).join(""),a=this._toStreetAddressParts(t,n).map((e=>e.replace(/\s/g,""))).join("");return this.strCompare(i,a,r)},compressTel(e){let t=e["tel-country-code"]||"",r=e["tel-area-code"]||"";e.tel||(e["tel-national"]?e.tel=t+e["tel-national"]:e["tel-local"]?e.tel=t+r+e["tel-local"]:e["tel-local-prefix"]&&e["tel-local-suffix"]&&(e.tel=t+r+e["tel-local-prefix"]+e["tel-local-suffix"]));for(let t in e)"tel"!=t&&"tel"==this.getCategoryFromFieldName(t)&&delete e[t]},autofillFieldSelector:e=>e.querySelectorAll("input, select"),isFieldAutofillable:e=>e&&!e.readOnly&&!e.disabled,isFieldVisible:e=>!e.hidden&&"none"!=e.style.display,isCreditCardOrAddressFieldType(e){if(!e)return!1;if(HTMLInputElement.isInstance(e)){if(!F.includes(e.type))return!1;if(!this.isFieldVisible(e))return!1}else if(!HTMLSelectElement.isInstance(e))return!1;return!0},loadDataFromScript:(e,t={})=>(Services.scriptloader.loadSubScript(e,t),t),getCountryAddressRawData(e=f.DEFAULT_REGION,t=null){let r=L.getData(e,t);if(!r){if(t)return null;e!=f.DEFAULT_REGION&&(r=L.getData(f.DEFAULT_REGION))}return r||(r=L.getData("US")),r},getCountryAddressData(e,t){let r=this.getCountryAddressRawData(e,t);return r&&r.defaultLocale},getCountryAddressDataWithLocales(e,t){let r=this.getCountryAddressRawData(e,t);return r&&[r.defaultLocale,...r.locales]},getSearchCollators(e){if(!this._collators[e]){let t=this.getCountryAddressData(e),r=t.languages||[t.lang],n={ignorePunctuation:!0,sensitivity:"base",usage:"search"};this._collators[e]=r.map((e=>new Intl.Collator(e,n)))}return this._collators[e]},FIELDS_LOOKUP:{N:"name",O:"organization",A:"street-address",S:"address-level1",C:"address-level2",D:"address-level3",Z:"postal-code",n:"newLine"},parseAddressFormat(e){if(!e)throw new Error("fmt string is missing.");return e.match(/%[^%]/g).reduce(((e,t)=>{let r=this.FIELDS_LOOKUP[t[1]];if(!r)return e;if("newLine"==r){let t=e.length;return t&&(e[t-1].newLine=!0),e}return e.concat({fieldId:r})}),[])},buildRegionMapIfAvailable(e,t,r,n){if(!e||!e.length||!r&&!n||r&&e.length!=r.length||n&&e.length!=n.length)return null;if(t&&t.length&&t.length==e.length)for(let r=0;r<t.length;r++)t[r]&&(e[r]=t[r]);let i=r||n;return new Map(e.map(((e,t)=>[e,i[t]])))},parseRequireString(e){if(!e)throw new Error("requireString string is missing.");return e.split("").map((e=>this.FIELDS_LOOKUP[e]))},identifyCountryCode(e,t){let r=t?[t]:[...f.countries.keys()];for(let t of r){let r=this.getSearchCollators(t),n=this.getCountryAddressData(t);t!=n.key&&(n={id:`data/${t}`,key:t,name:f.countries.get(t)});let i=n.alternative_names||[n.name],a=this._reAlternativeCountryNames[t];a||(a=this._reAlternativeCountryNames[t]=[]);for(let n=0;n<i.length;n++){let s=i[n],l=a[n];if(l||(l=a[n]=new RegExp("\\b"+this.escapeRegExp(s)+"\\b","i")),this.strCompare(s,e,r)||l.test(e))return t}}return null},findSelectOption(e,t,r){return this.isAddressField(r)?this.findAddressSelectOption(e,t,r):this.isCreditCardField(r)?this.findCreditCardSelectOption(e,t,r):null},getAbbreviatedSubregionName(e,t){let r=Array.isArray(e)?e:[e],n=this.getSearchCollators(t);for(let e of this.getCountryAddressDataWithLocales(t)){let{sub_keys:t,sub_names:i,sub_lnames:a}=e;if(!t)continue;i=i||a;let s=[];for(const e of r){let r=this.identifyValue(t,i,e,n);if(r)return r;[t,i].forEach((t=>{s.push(t.findIndex((t=>new RegExp("\\b"+this.escapeRegExp(t)+"\\b").test(e))))}))}let l=t[s.find((e=>!!~e))];if(l)return l}return null},findAddressSelectOption(e,t,r){if(e.options.length>512)return null;let n=t[r];if(!n)return null;let i=this.getSearchCollators(t.country);for(let t of e.options)if(this.strCompare(n,t.value,i)||this.strCompare(n,t.text,i))return t;switch(r){case"address-level1":{let{country:r}=t,a=this.getAbbreviatedSubregionName([n],r);if(!a)return null;for(let t of this.getCountryAddressDataWithLocales(r)){let r=t.sub_keys;if(!r)continue;let n=t.sub_names||t.sub_lnames,s=new RegExp("\\b"+this.escapeRegExp(a)+"\\b","i");for(let t of e.options){let e=this.identifyValue(r,n,t.value,i),l=this.identifyValue(r,n,t.text,i);if(a===e||a===l||s.test(t.value))return t}}break}case"country":if(this.getCountryAddressData(n).alternative_names)for(let t of e.options)if(this.identifyCountryCode(t.text,n)||this.identifyCountryCode(t.value,n))return t}return null},findCreditCardSelectOption(e,t,r){let n=t["cc-exp-month"]?t["cc-exp-month"].toString():null,i=n?n.padStart(2,"0"):null,a=t["cc-exp-year"]?t["cc-exp-year"].toString():null,s=a?a.substr(2,2):null,l=Array.from(e.options);switch(r){case"cc-exp-month":if(!n)return null;for(let e of l)if([e.text,e.label,e.value].some((e=>{let t=/[1-9]\d*/.exec(e);return t&&t[0]==n})))return e;break;case"cc-exp-year":if(!a)return null;for(let e of l)if([e.text,e.label,e.value].some((e=>e==s||e==a)))return e;break;case"cc-exp":{if(!n||!a)return null;let e=[n+"/"+s,n+"/"+a,i+"/"+s,i+"/"+a,n+"-"+s,n+"-"+a,i+"-"+s,i+"-"+a,s+"-"+i,a+"-"+i,a+"/"+n,i+s,s+i];for(let t of l)if([t.text,t.label,t.value].some((t=>e.some((e=>t.includes(e))))))return t;break}case"cc-type":{let e=t["cc-type"]||"";for(let t of l)if([t.text,t.label,t.value].some((t=>b.getNetworkFromName(t)==e)))return t;break}}return null},identifyValue(e,t,r,n){let i=e.find((e=>this.strCompare(r,e,n)));if(i)return i;let a=t.findIndex((e=>this.strCompare(r,e,n)));return-1!==a?e[a]:null},strCompare:(e="",t="",r)=>r.some((r=>!r.compare(e,t))),strInclude(e="",t="",r){const n=e.length-t.length;for(let i=0;i<=n;i++)if(this.strCompare(e.substring(i,i+t.length),t,r))return!0;return!1},escapeRegExp:e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),getFormFormat(e){let t=this.getCountryAddressData(e);return e!=t.key&&(t={fmt:"%N%n%O%n%A%n%C %S %Z"}),{addressLevel3L10nId:this.getAddressFieldL10nId(t.sublocality_name_type||"suburb"),addressLevel2L10nId:this.getAddressFieldL10nId(t.locality_name_type||"city"),addressLevel1L10nId:this.getAddressFieldL10nId(t.state_name_type||"province"),addressLevel1Options:this.buildRegionMapIfAvailable(t.sub_keys,t.sub_isoids,t.sub_names,t.sub_lnames),countryRequiredFields:this.parseRequireString(t.require||"AC"),fieldsOrder:this.parseAddressFormat(t.fmt||"%N%n%O%n%A%n%C"),postalCodeL10nId:this.getAddressFieldL10nId(t.zip_name_type||"postal-code"),postalCodePattern:t.zip}},getAddressFieldL10nId:e=>"autofill-address-"+e.replace(/_/g,"-"),CC_FATHOM_NONE:0,CC_FATHOM_JS:1,CC_FATHOM_NATIVE:2,isFathomCreditCardsEnabled(){return this.ccHeuristicsMode!=this.CC_FATHOM_NONE},formAutofillConfidencesKeyToCCFieldType:e=>({ccNumber:"cc-number",ccName:"cc-name",ccType:"cc-type",ccExp:"cc-exp",ccExpMonth:"cc-exp-month",ccExpYear:"cc-exp-year"}[e])},r.defineLazyGetter(_,"stringBundle",(function(){return Services.strings.createBundle("chrome://formautofill/locale/formautofill.properties")})),r.defineLazyGetter(_,"brandBundle",(function(){return Services.strings.createBundle("chrome://branding/locale/brand.properties")})),r.defineLazyPreferenceGetter(_,"_reauthEnabledByUser","extensions.formautofill.reauth.enabled",!1),r.defineLazyPreferenceGetter(_,"ccHeuristicsMode","extensions.formautofill.creditCards.heuristics.mode",0),r.defineLazyPreferenceGetter(_,"ccFathomConfidenceThreshold","extensions.formautofill.creditCards.heuristics.fathom.confidenceThreshold",null,null,(e=>parseFloat(e))),r.defineLazyPreferenceGetter(_,"ccFathomHighConfidenceThreshold","extensions.formautofill.creditCards.heuristics.fathom.highConfidenceThreshold",null,null,(e=>parseFloat(e))),r.defineLazyPreferenceGetter(_,"ccFathomTestConfidence","extensions.formautofill.creditCards.heuristics.fathom.testConfidence",null,null,(e=>parseFloat(e)));const{FIELD_STATES:M}=_;class C{static SHOULD_FOCUS_ON_AUTOFILL=!0;#e=null;constructor(t,n){this.fieldDetails=t,this.handler=n,this.filledRecordGUID=null,r.defineLazyGetter(this,"reauthPasswordPromptMessage",(()=>{const t=_.brandBundle.GetStringFromName("brandShortName"),r=e.platform.replace("macosx","macos");return _.stringBundle.formatStringFromName(`useCreditCardPasswordPrompt.${r}`,[t])})),r.defineLazyGetter(this,"log",(()=>f.defineLogGetter(this,"FormAutofillHandler"))),this.isValidSection()||(this.fieldDetails=[],this.log.debug(`Ignoring ${this.constructor.name} related fields since it is an invalid section`)),this._cacheValue={allFieldNames:null,matchingSelectOption:null},this.flowId=Services.uuid.generateUUID().toString(),this.log.debug("Creating new credit card section with flowId =",this.flowId)}isValidSection(){throw new TypeError("isValidSection method must be overrided")}isEnabled(){throw new TypeError("isEnabled method must be overrided")}isRecordCreatable(e){throw new TypeError("isRecordCreatable method must be overridden")}createNormalizedRecord(e){}applyTransformers(e){}preparePreviewProfile(e){}async prepareFillingProfile(e){return!0}getFilledValueFromProfile(e,t){return t[`${e.fieldName}-formatted`]||t[e.fieldName]}computeFillingValue(e,t,r){return e}set focusedInput(e){this.#e=e}getFieldDetailByElement(e){return this.fieldDetails.find((t=>t.elementWeakRef.get()==e))}getFieldDetailByName(e){return this.fieldDetails.find((t=>t.fieldName==e))}get allFieldNames(){return this._cacheValue.allFieldNames||(this._cacheValue.allFieldNames=this.fieldDetails.map((e=>e.fieldName))),this._cacheValue.allFieldNames}matchSelectOptions(e){this._cacheValue.matchingSelectOption||(this._cacheValue.matchingSelectOption=new WeakMap);for(let t in e){let r=this.getFieldDetailByName(t);if(!r)continue;let n=r.elementWeakRef.get();if(!HTMLSelectElement.isInstance(n))continue;let i=this._cacheValue.matchingSelectOption.get(n)||{},a=e[t];if(i[a]&&i[a].get())continue;let s=_.findSelectOption(n,e,t);s?(i[a]=Cu.getWeakReference(s),this._cacheValue.matchingSelectOption.set(n,i)):(i[a]&&(delete i[a],this._cacheValue.matchingSelectOption.set(n,i)),delete e[t])}}adaptFieldMaxLength(e){for(let t in e){let r=this.getFieldDetailByName(t);if(!r)continue;let n=r.elementWeakRef.get();if(!n)continue;let i=n.maxLength;if(!(void 0===i||i<0||e[t].toString().length<=i))if(i)switch(typeof e[t]){case"string":if("cc-exp"==t&&5==i){const r=("0"+e["cc-exp-month"].toString()).slice(-2),n=e["cc-exp-year"].toString().slice(-2);e[t]=`${r}/${n}`}else e[t]="cc-number"==t?e[t].substr(e[t].length-i):e[t].substr(0,i);break;case"number":i<1&&(i=1),e[t]=e[t]%Math.pow(10,i)}else delete e[t],delete e[`${t}-formatted`]}}fillFieldValue(e,t,r=C.SHOULD_FOCUS_ON_AUTOFILL){r&&e.focus({preventScroll:!0}),HTMLInputElement.isInstance(e)?e.setUserInput(t):HTMLSelectElement.isInstance(e)&&(e.value=t,e.dispatchEvent(new e.ownerGlobal.Event("input",{bubbles:!0})),e.dispatchEvent(new e.ownerGlobal.Event("change",{bubbles:!0})))}getAdaptedProfiles(e){for(let t of e)this.applyTransformers(t);return e}async autofillFields(e){if(!this.#e)throw new Error("No focused input.");if(!this.getFieldDetailByElement(this.#e))throw new Error("No fieldDetail for the focused input.");if(!await this.prepareFillingProfile(e))return this.log.debug("profile cannot be filled"),!1;this.filledRecordGUID=e.guid;for(const t of this.fieldDetails){const r=t.elementWeakRef.get();if(!_.isFieldAutofillable(r))continue;r.previewValue="";const n=this.getFilledValueFromProfile(t,e);if(HTMLInputElement.isInstance(r)&&n)r!=this.#e&&(r==this.#e||r.value&&r.value!=r.defaultValue)&&this.handler.getFilledStateByElement(r)!=M.AUTO_FILLED||(this.fillFieldValue(r,n),this.handler.changeFieldState(t,M.AUTO_FILLED));else if(HTMLSelectElement.isInstance(r)){let e=this._cacheValue.matchingSelectOption.get(r)||{},i=e[n]&&e[n].get();if(!i)continue;i.selected||(i.selected=!0,this.fillFieldValue(r,i.value)),this.handler.changeFieldState(t,M.AUTO_FILLED)}}return this.#e.focus({preventScroll:!0}),l.recordFormInteractionEvent("filled",this,{profile:e}),!0}previewFormFields(e){this.preparePreviewProfile(e);for(const t of this.fieldDetails){let r=t.elementWeakRef.get();if(!_.isFieldAutofillable(r))continue;let n=e[`${t.fieldName}-formatted`]||e[t.fieldName]||"";if(HTMLSelectElement.isInstance(r)){if(n){const e=(this._cacheValue.matchingSelectOption.get(r)??{})[n]?.get();n=e?.text??""}}else if(r.value&&r.value!=r.defaultValue)continue;r.previewValue=n,this.handler.changeFieldState(t,n?M.PREVIEW:M.NORMAL)}}clearFilled(e){l.recordFormInteractionEvent("filled_modified",this,{fieldName:e.fieldName});let t=!1;const r=[];for(const e of this.fieldDetails){const n=e.elementWeakRef.get();HTMLSelectElement.isInstance(n)?r.push(e):t|=this.handler.getFilledStateByElement(n)==M.AUTO_FILLED}if(!t){for(const e of r){let t=e.elementWeakRef.get();this._resetSelectElementValue(t),this.handler.changeFieldState(e,M.NORMAL)}this.filledRecordGUID=null}}clearPreviewedFormFields(){this.log.debug("clear previewed fields");for(const e of this.fieldDetails){let t=e.elementWeakRef.get();t?(t.previewValue="",this.handler.getFilledStateByElement(t)!=M.AUTO_FILLED&&this.handler.changeFieldState(e,M.NORMAL)):this.log.warn(e.fieldName,"is unreachable")}}clearPopulatedForm(){for(let e of this.fieldDetails){let t=e.elementWeakRef.get();t?this.handler.getFilledStateByElement(t)==M.AUTO_FILLED&&(HTMLInputElement.isInstance(t)?t.setUserInput(""):HTMLSelectElement.isInstance(t)&&this._resetSelectElementValue(t)):this.log.warn(e.fieldName,"is unreachable")}}resetFieldStates(){for(const e of this.fieldDetails)e.elementWeakRef.get().removeEventListener("input",this,{mozSystemGroup:!0}),this.handler.changeFieldState(e,M.NORMAL);this.filledRecordGUID=null}isFilled(){return!!this.filledRecordGUID}_condenseMultipleCCNumberFields(e){let t=0;for(let r=e.length-1;r>=0;r--)"cc-number"==e[r].fieldName?(t++,4==t&&(t=0,e[r].fieldValue=e[r].elementWeakRef.get()?.value+e[r+1].elementWeakRef.get()?.value+e[r+2].elementWeakRef.get()?.value+e[r+3].elementWeakRef.get()?.value,e.splice(r+1,3))):t=0}createRecord(){let e=this.fieldDetails;if(!this.isEnabled()||!e||!e.length)return null;let t={guid:this.filledRecordGUID,record:{},untouchedFields:[],section:this};this.flowId&&(t.flowId=this.flowId);let r=this.fieldDetails;return this._condenseMultipleCCNumberFields(r),r.forEach((e=>{const r=e.elementWeakRef.get();let n=e.fieldValue??(r&&r.value.trim());n=this.computeFillingValue(n,e,r),!n||n.length>_.MAX_FIELD_VALUE_LENGTH?t.record[e.fieldName]="":(t.record[e.fieldName]=n,this.handler.getFilledStateByElement(r)==M.AUTO_FILLED&&t.untouchedFields.push(e.fieldName))})),this.createNormalizedRecord(t),this.isRecordCreatable(t.record)?t:null}_resetSelectElementValue(e){if(!e.options.length)return;let t=[...e.options].find((e=>e.hasAttribute("selected")));e.value=t?t.value:e.options[0].value,e.dispatchEvent(new e.ownerGlobal.Event("input",{bubbles:!0})),e.dispatchEvent(new e.ownerGlobal.Event("change",{bubbles:!0}))}}class N extends C{constructor(e,t){super(e,t),this._cacheValue.oneLineStreetAddress=null,l.recordDetectedSectionCount(this),l.recordFormInteractionEvent("detected",this)}isValidSection(){return this.fieldDetails.length>=_.AUTOFILL_FIELDS_THRESHOLD}isEnabled(){return f.isAutofillAddressesEnabled}isRecordCreatable(e){if(e.country&&!f.isAutofillAddressesAvailableInCountry(e.country))return this.log.warn("isRecordCreatable: Country not supported:",e.country),!1;let t=0,r=0;for(let n of Object.keys(e))e[n]&&("name"!=_.getCategoryFromFieldName(n)?r++:t=1);return r+t>=_.AUTOFILL_FIELDS_THRESHOLD}_getOneLineStreetAddress(e){return this._cacheValue.oneLineStreetAddress||(this._cacheValue.oneLineStreetAddress={}),this._cacheValue.oneLineStreetAddress[e]||(this._cacheValue.oneLineStreetAddress[e]=_.toOneLineAddress(e)),this._cacheValue.oneLineStreetAddress[e]}addressTransformer(e){if(e["street-address"]){e["-moz-street-address-one-line"]=this._getOneLineStreetAddress(e["street-address"]);let t=this.getFieldDetailByName("street-address");t&&HTMLInputElement.isInstance(t.elementWeakRef.get())&&(e["street-address"]=e["-moz-street-address-one-line"]);let r=[];for(let t of["address-line3","address-line2","address-line1"])r.unshift(e[t]),this.getFieldDetailByName(t)&&(r.length>1&&(e[t]=_.toOneLineAddress(r)),r=[])}}telTransformer(e){if(!e.tel||!e["tel-national"])return;let t=this.getFieldDetailByName("tel");if(!t)return;let r,n=t.elementWeakRef.get(),i=e=>(r||(r=new RegExp("^(?:"+n.pattern+")$","u")),r.test(e));if(n.pattern){if(i(e.tel))return}else if(n.maxLength&&"autocomplete"==t.reason&&e.tel.length<=n.maxLength)return;"autocomplete"!=t.reason?e.tel=e["tel-national"]:n.pattern?i(e["tel-national"])&&(e.tel=e["tel-national"]):n.maxLength&&e["tel-national"].length<=n.maxLength&&(e.tel=e["tel-national"])}applyTransformers(e){this.addressTransformer(e),this.telTransformer(e),this.matchSelectOptions(e),this.adaptFieldMaxLength(e)}computeFillingValue(e,t,r){if("address-level1"==t.fieldName&&HTMLSelectElement.isInstance(r))if(e&&1==r.selectedOptions.length){let t=r.selectedOptions[0].text.trim();e=_.getAbbreviatedSubregionName([e,t])||t}else e="";return e}createNormalizedRecord(e){if(e){if(e.record.country&&"autocomplete"!=this.getFieldDetailByName("country").reason){let t=_.identifyCountryCode(e.record.country);t&&(e.record.country=t)}if(_.compressTel(e.record),e.record.tel)if(Object.keys(e.record).filter((e=>"tel"==_.getCategoryFromFieldName(e))).every((t=>e.untouchedFields.includes(t))))e.untouchedFields.includes("tel")||e.untouchedFields.push("tel");else{let t=e.record.tel.replace(/[\s\(\)-]/g,"");/^(\+?)[\da-zA-Z]{5,15}$/.test(t)||(e.record.tel="")}}}}class A extends C{constructor(e,t){super(e,t),this.isValidSection()&&(l.recordDetectedSectionCount(this),l.recordFormInteractionEvent("detected",this),t.window.location!=t.window.parent?.location&&(this.log.debug("Credit card form is in an iframe -- watching for pagehide",e),t.window.addEventListener("pagehide",this._handlePageHide.bind(this))))}_handlePageHide(e){this.handler.window.removeEventListener("pagehide",this._handlePageHide.bind(this)),this.log.debug("Credit card subframe is pagehideing",this.handler.form),this.handler.onFormSubmitted()}isValidSection(){let e=null,t=null,r=null;for(let n of this.fieldDetails)switch(n.fieldName){case"cc-number":e=n;break;case"cc-name":case"cc-given-name":case"cc-additional-name":case"cc-family-name":t=n;break;case"cc-exp":case"cc-exp-month":case"cc-exp-year":r=n}if("autocomplete"==e?.reason||"autocomplete"==t?.reason||"autocomplete"==r?.reason)return!0;if(e?.confidence>0){if(t||r)return!0}else if(t?.confidence>0&&(e||r))return!0;let n,i=_.ccFathomHighConfidenceThreshold;if(e?.confidence>i?n=e:t?.confidence>i&&(n=t),n){const e=n.elementWeakRef.get(),t=(e.form||e.ownerDocument).querySelectorAll("input:not([type=hidden])");if(1==t.length&&t[0]==e)return!0}return!1}isEnabled(){return f.isAutofillCreditCardsEnabled}isRecordCreatable(e){return e["cc-number"]&&_.isCCNumber(e["cc-number"])}creditCardExpiryDateTransformer(e){if(!e["cc-exp"])return;let t=this.getFieldDetailByName("cc-exp");if(!t)return;function r(e,t,r){let n;return n=new RegExp("(?:\\b|^)((?:[m]{2}){1,2})\\s*([\\-/])\\s*((?:[yaj]{2}){1,2})(?:\\b|$)","i").exec(e),n?t.toString().padStart(n[1].length,"0")+n[2]+r.toString().substr(-1*n[3].length):(n=new RegExp("(?:\\b|^)((?:[yaj]{2}){1,2})\\s*([\\-/])\\s*((?:[m]){1,2})(?:\\b|$)","i").exec(e),n?r.toString().substr(-1*n[1].length)+n[2]+t.toString().padStart(n[3].length,"0"):null)}let n,i=t.elementWeakRef.get(),a=e["cc-exp-month"],s=e["cc-exp-year"];"INPUT"==i.tagName&&(i.placeholder&&(n=r(i.placeholder,a,s)),n||"LABEL"!=i.previousElementSibling?.tagName||(n=r(i.previousElementSibling.textContent,a,s))),e["cc-exp"]=n||a.toString().padStart(2,"0")+"/"+s.toString()}creditCardExpMonthAndYearTransformer(e){const t=(e,t)=>{if(!e)return null;let r=t.getFieldDetailByName(e);if(!r)return null;let n=r.elementWeakRef.get();return"INPUT"===n.tagName?n:null};t("cc-exp-month",this)&&(e["cc-exp-month-formatted"]=e["cc-exp-month"]?.toString().padStart(2,"0"));let r=t("cc-exp-year",this);if(r){let t=r.placeholder;/\b(yy|aa|jj)\b/i.test(t)&&(e["cc-exp-year-formatted"]=e["cc-exp-year"].toString().substring(2))}}async _decrypt(e,t){let r;for(let e of this.fieldDetails){let t=e.elementWeakRef.get();if(t){r=t.ownerGlobal;break}}return r?r.windowGlobalChild.getActor("FormAutofill").sendQuery("FormAutofill:GetDecryptedString",{cipherText:e,reauth:t}):null}applyTransformers(e){this.creditCardExpiryDateTransformer(e),this.creditCardExpMonthAndYearTransformer(e),this.matchSelectOptions(e),this.adaptFieldMaxLength(e)}getFilledValueFromProfile(e,t){const r=super.getFilledValueFromProfile(e,t);if("cc-number"==e.fieldName&&null!=e.part){const t=e.part;return r.slice(4*(t-1),4*t)}return r}computeFillingValue(e,t,r){if("cc-type"!=t.fieldName||!HTMLSelectElement.isInstance(r))return e;if(b.isValidNetwork(e))return e;if(e&&1==r.selectedOptions.length){let e=r.selectedOptions[0],t=b.getNetworkFromName(e.text)??b.getNetworkFromName(e.value);if(t)return t}return e}preparePreviewProfile(e){e["cc-number-decrypted"]?e["cc-number"]=e["cc-number-decrypted"]:e["cc-number"].startsWith("****")||(e["cc-number"]="****"+e["cc-number"])}async prepareFillingProfile(e){if(e["cc-number-encrypted"]){let t=await this._decrypt(e["cc-number-encrypted"],this.reauthPasswordPromptMessage);if(!t)return!1;e["cc-number"]=t}return!0}async autofillFields(e){return this.getAdaptedProfiles([e]),!!await super.autofillFields(e)}createNormalizedRecord(e){if(!e?.record["cc-number"])return;e.record["cc-number"]=b.normalizeCardNumber(e.record["cc-number"]);let{month:t,year:r}=b.normalizeExpiration({expirationString:e.record["cc-exp"],expirationMonth:e.record["cc-exp-month"],expirationYear:e.record["cc-exp-year"]});t&&(e.record["cc-exp-month"]=t),r&&(e.record["cc-exp-year"]=r)}}C.SHOULD_FOCUS_ON_AUTOFILL=!1;class R extends Error{}function w(e){return e}function v(e,t,r){let n,i,a=!0;if(Y((function(e){const s=t(e);(r(s,i)||a)&&(n=e,i=s,a=!1)}),e),a)throw new Error("Tried to call best() on empty iterable");return n}function I(e,t=w){return v(e,t,((e,t)=>e<t))}function T(e){let t,r=!0;return Y((function(e){r?(t=e,r=!1):t+=e}),e),t}function $(e){return e.nodeType===e.TEXT_NODE&&0===e.textContent.trim().length}function D(e,t,r){if(e.has(t))return e.get(t);const n=r();return e.set(t,n),n}function O(e,t,r){return e.has(t)?e.get(t):r()}Error,new Set(["ADDRESS","BLOCKQUOTE","BODY","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","HR","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL","DD","DT","FRAMESET","LI","TBODY","TD","TFOOT","TH","THEAD","TR","HTML"]);class k extends Set{pop(){for(let e of this.values())return this.delete(e),e;throw new Error("Tried to pop from an empty NiceSet.")}extend(e){for(let t of e)this.add(t);return this}minus(e){const t=new k(this);for(const r of e)t.delete(r);return t}toString(){return"{"+Array.from(this).join(", ")+"}"}}function U(e){for(let t of e)return t}function*P(e){for(const r of e)"string"!=typeof r&&(t=r)&&"function"==typeof t[Symbol.iterator]?yield*P(r):yield r;var t}function*z(e,t){for(const r of t)yield e(r)}function Y(e,t){for(const r of t)e(r)}function G(e){return void 0!==e.nodeName}function*H(e){for(let t=e.length-1;t>=0;t--)yield e[t]}function V(e,t){let r=0,n=e,i=n&&n!==t;for(;i;)n=n.nextSibling,(i=n&&n!==t)&&!$(n)&&(r+=1);if(n!==t)for(n=t;n;)n=n.previousSibling,n&&!$(n)&&(r+=1);return r}function B(e,t,{differentDepthCost:r=2,differentTagCost:n=2,sameTagCost:i=1,strideCost:a=1,additionalCost:s=((e,t)=>0)}={}){if(e===t)return 0;const l=G(e)?e:e.element,o=G(t)?t:t.element,d=[l],c=[o];let u=l,m=o;for(;!u.contains(o);)u=u.parentNode,d.push(u);const h=l.compareDocumentPosition(o);if(h&(l.DOCUMENT_POSITION_CONTAINS|l.DOCUMENT_POSITION_CONTAINED_BY))return Number.MAX_VALUE;do{m=m.parentNode,c.push(m)}while(m!==u);let p=d,f=c,g=0;for(h&l.DOCUMENT_POSITION_FOLLOWING?(p=d,f=c):h&l.DOCUMENT_POSITION_PRECEDING&&(p=c,f=d);p.length||f.length;){const e=p.pop(),t=f.pop();g+=void 0===e||void 0===t?r:e.tagName===t.tagName?i:n,0!==a&&(g+=V(e,t)*a)}return g+s(e,t)}class W{constructor(e,t){this._matrix=new Map;const r=e.map((e=>[e]));for(let e of r){const r=new Map;for(let n of this._matrix.keys())r.set(n,t(e[0],n[0]));this._matrix.set(e,r)}this._numClusters=r.length}closest(){const e=this;if(this._numClusters<2)throw new Error("There must be at least 2 clusters in order to return the closest() ones.");return I(function(){const t=[];for(let[r,n]of e._matrix.entries())for(let[e,i]of n.entries())t.push({a:r,b:e,distance:i});return t}(),(e=>e.distance))}_cachedDistance(e,t){let r=this._matrix.get(e).get(t);return void 0===r&&(r=this._matrix.get(t).get(e)),r}merge(e,t){const r=new Map;for(let n of this._matrix.keys())n!==e&&n!==t&&r.set(n,Math.min(this._cachedDistance(e,n),this._cachedDistance(t,n)));this._matrix.delete(e),this._matrix.delete(t);for(let r of this._matrix.values())r.delete(e),r.delete(t);this._matrix.set([e,t],r),this._numClusters-=1}numClusters(){return this._numClusters}clusters(){return Array.from(this._matrix.keys()).map((e=>Array.from(P(e))))}}class j{constructor(){this._predicate=()=>!0}static fromFirstCall(e){if("type"===e.method)return new J(...e.args);if("and"===e.method)return new ee(e.args);if("nearest"===e.method)return new re(e.args);throw new Error("The left-hand side of a rule() must start with dom(), type(), and(), or nearest().")}when(e){let t=this.clone();return t._predicate=e,t}fnodesSatisfyingWhen(e){return Array.from(e).filter(this._predicate)}checkFact(e){}guaranteedType(){}aggregatedType(){}}class K extends j{constructor(e){if(super(),void 0===e)throw new Error("A querySelector()-style selector is required as the argument to "+this._callName()+"().");this.selector=e}_callName(){return"dom"}clone(){return new this.constructor(this.selector)}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.querySelectorAll(this.selector))}_domNodesToFilteredFnodes(e,t){let r=[];for(let n=0;n<t.length;n++)r.push(e.fnodeForElement(t[n]));return this.fnodesSatisfyingWhen(r)}checkFact(e){if(void 0===e.type)throw new Error(`The right-hand side of a ${this._callName()}() rule failed to specify a type. This means there is no way for its output to be used by later rules. All it specified was ${e}.`)}asLhs(){return this}possibleTypeCombinations(){return[]}typesMentioned(){return new k}}class q extends K{_callName(){return"element"}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.matches(this.selector)?[e.doc]:[])}}class J extends j{constructor(e){if(super(),void 0===e)throw new Error("A type name is required when calling type().");this._type=e}clone(){return new this.constructor(this._type)}fnodes(e){const t=O(e.typeCache,this._type,(()=>[]));return this.fnodesSatisfyingWhen(t)}type(e){return new this.constructor(e)}max(){return new Z(this._type)}bestCluster(e){return new Q(this._type,e)}guaranteedType(){return this._type}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new k([this._type])}}class X extends J{aggregatedType(){return this._type}}class Z extends X{fnodes(e){const t=this,r=()=>super.fnodes(e);return D(e.maxCache,this._type,(function(){return function(e,t=w){let r,n=[],i=!0;return Y((function(e){const a=t(e);a>r||i?(n=[e],r=a,i=!1):a===r&&n.push(e)}),e),n}(r(),(r=>e.weightedScore(r.scoresSoFarFor(t._type))))}))}}class Q extends X{constructor(e,t){super(e),this._options=t||{splittingDistance:3}}fnodes(e){const t=Array.from(super.fnodes(e));return 0===t.length?[]:function(e,t=w){return v(e,t,((e,t)=>e>t))}(function(e,t,r=B){const n=new W(e,r);let i;for(;n.numClusters()>1&&(i=n.closest()).distance<t;)n.merge(i.a,i.b);return n.clusters()}(t,this._options.splittingDistance,((e,t)=>B(e,t,this._options))).map((e=>[e,T(e.map((e=>e.scoreFor(this._type))))])),(e=>e[1]))[0]}}class ee extends j{constructor(e){super(),this._args=e.map(te)}*fnodes(e){const t=this._args[0].fnodes(e);e:for(let e of t){for(let t of this._args.slice(1))if(!e.hasType(t.guaranteedType()))continue e;yield e}}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new k(this._args.map((e=>e.guaranteedType())))}}function te(e){const t=e.asLhs();if(t.constructor!==J)throw new Error("and() and nearest() support only simple type() calls as arguments for now.");return t}class re extends j{constructor([e,t,r]){super(),this._a=te(e),this._b=te(t),this._distance=r}*fnodes(e){const t=this._a.fnodes(e),r=Array.from(this._b.fnodes(e));if(r.length>0)for(const e of t){const t=I(r,(t=>this._distance(e,t)));yield{fnode:e,rhsTransformer:function(e){return void 0===e.note&&(e.note=t),e}}}}checkFact(e){}possibleTypeCombinations(){return[new k([this._a.guaranteedType()])]}typesMentioned(){return new k([this._a.guaranteedType(),this._b.guaranteedType()])}guaranteedType(){return this._a.guaranteedType()}}const ne={type:1,note:2,score:4,element:8};function ie(e){return new se(e)}class ae{constructor(e=[],t=1/0,r){this._calls=e.slice(),this._max=t,this._types=new k(r)}atMost(e){return new this.constructor(this._calls,e,this._types)}_checkAtMost(e){if(void 0!==e.score&&e.score>this._max)throw new Error(`Score of ${e.score} exceeds the declared atMost(${this._max}).`)}props(e){function t(r){const n=e(r);for(let e in n)ne.hasOwnProperty(e)&&ne[e]&t.possibleSubfacts||delete n[e];return n}return t.possibleSubfacts=15,t.kind="props",new this.constructor(this._calls.concat(t),this._max,this._types)}type(e){function t(){return{type:e}}return t.possibleSubfacts=1,t.type=e,t.kind="type",new this.constructor(this._calls.concat(t),this._max,this._types)}typeIn(...e){return new this.constructor(this._calls,this._max,e)}_checkTypeIn(e,t){if(this._types.size>0)if(void 0===e.type){if(!this._types.has(t))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually inherited ${t} from the left-hand side.`)}else if(!this._types.has(e.type))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually emitted ${e.type}.`)}note(e){function t(t){return{note:e(t)}}return t.possibleSubfacts=2,t.kind="note",new this.constructor(this._calls.concat(t),this._max,this._types)}score(e){let t;return t="number"==typeof e?function(t){return{score:e}}:function(t){let r=e(t);return"boolean"==typeof r&&(r=Number(r)),{score:r}},t.possibleSubfacts=4,t.kind="score",new this.constructor(this._calls.concat(t),this._max,this._types)}fact(e,t){const r=new Set,n={};let i=0;for(let t of H(this._calls))if(!r.has(t.kind)&&(r.add(t.kind),~i&t.possibleSubfacts)){const r=t(e);for(let e in r)n.hasOwnProperty(e)||(n[e]=r[e]),i|=ne[e]}return this._checkAtMost(n),this._checkTypeIn(n,t),n}possibleEmissions(){let e=!1;for(let t of H(this._calls)){if("props"===t.kind){e=!0;break}if("type"===t.kind)return{couldChangeType:!0,possibleTypes:new Set([t.type])}}return{couldChangeType:e,possibleTypes:this._types}}}class se{constructor(e,t=(e=>e),r=(e=>e)){this.key=e,this.callback=t,this.allCallback=r}through(e){return new this.constructor(this.key,e,this.allCallback)}allThrough(e){return new this.constructor(this.key,this.callback,e)}asRhs(){return this}}function le(e){return new oe({method:"type",args:[e]})}class oe{constructor(...e){this._calls=e}max(){return this._and("max")}bestCluster(e){return this._and("bestCluster",e)}props(e){return this._and("props",e)}type(...e){return this._and("type",...e)}note(e){return this._and("note",e)}score(e){return this._and("score",e)}atMost(e){return this._and("atMost",e)}typeIn(...e){return this._and("typeIn",...e)}and(...e){return this._and("and",e)}_and(e,...t){return new this.constructor(...this._calls.concat({method:e,args:t}))}asLhs(){return this._asSide(j.fromFirstCall(this._calls[0]),this._calls.slice(1))}asRhs(){return this._asSide(new ae,this._calls)}_asSide(e,t){for(let r of t)e=e[r.method](...r.args);return e}when(e){return this._and("when",e)}}class de{constructor(e,t){if(void 0===e)throw new Error("Someone tried to make a fnode without specifying the element they're talking about.");this.element=e,this._ruleset=t,this._types=new Map,this._conservedScores=new Map}hasType(e){return this._computeType(e),this._types.has(e)}scoreFor(e){return this._computeType(e),t=this._ruleset.weightedScore(this.scoresSoFarFor(e))+O(this._ruleset.biases,e,(()=>0)),1/(1+Math.exp(-t));var t}noteFor(e){return this._computeType(e),this._noteSoFarFor(e)}hasNoteFor(e){return this._computeType(e),this._hasNoteSoFarFor(e)}typesSoFar(){return this._types.keys()}_noteSoFarFor(e){return this._typeRecordForGetting(e).note}_hasNoteSoFarFor(e){return void 0!==this._noteSoFarFor(e)}scoresSoFarFor(e){return this._typeRecordForGetting(e).score}addScoreFor(e,t,r){this._typeRecordForSetting(e).score.set(r,t)}setNoteFor(e,t){if(this._hasNoteSoFarFor(e)){if(void 0!==t)throw new Error(`Someone (likely the right-hand side of a rule) tried to add a note of type ${e} to an element, but one of that type already exists. Overwriting notes is not allowed, since it would make the order of rules matter.`)}else this._typeRecordForSetting(e).note=t}_typeRecordForSetting(e){return D(this._types,e,(()=>({score:new Map})))}_typeRecordForGetting(e){return O(this._types,e,(()=>({score:new Map})))}_computeType(e){this._types.has(e)||this._ruleset.get(le(e))}}function ce(e,t,r){return"string"==typeof t&&(t=ie(t)),new(t instanceof se?pe:he)(e,t,r)}let ue=0;class me{constructor(e,t,r){this.lhs=e.asLhs(),this.rhs=t.asRhs(),this.name=(r?r.name:void 0)||"_"+ue++}prerequisites(e){function t(e,t,r,n){for(let i of t){const t=r(i);if(!(t.length>0))throw new Error(`No rule ${n} the "${i}" type, but another rule needs it as input.`);e.extend(t)}}const r=new k;return t(r,this._typesFinalized(),(t=>e.inwardRulesThatCouldEmit(t)),"emits"),t(r,this.lhs.typesMentioned(),(t=>e.inwardRulesThatCouldAdd(t)),"adds"),r}_typesFinalized(){const e=this.lhs.aggregatedType();return void 0===e?new k:new k([e])}}class he extends me{results(e){if(e.doneRules.has(this))throw new Error("A bug in Fathom caused results() to be called on an inward rule twice. That could cause redundant score contributions, etc.");const t=this,r=this.lhs.fnodes(e),n=new Set;Y((function(r){const i=t.lhs.guaranteedType(),{fnode:a=r,rhsTransformer:s=w}=r,l=s(t.rhs.fact(a,i));t.lhs.checkFact(l);const o=e.fnodeForElement(l.element||a.element),d=l.type||t.lhs.guaranteedType();if(void 0!==l.score){if(void 0===d)throw new Error(`The right-hand side of a rule specified a score (${l.score}) with neither an explicit type nor one we could infer from the left-hand side.`);o.addScoreFor(d,l.score,t.name)}if(void 0!==l.type||void 0!==l.note){if(void 0===d)throw new Error(`The right-hand side of a rule specified a note (${l.note}) with neither an explicit type nor one we could infer from the left-hand side. Notes are per-type, per-node, so that's a problem.`);o.setNoteFor(d,l.note)}n.add(o)}),r),e.doneRules.add(this);for(let t of n)for(let r of t.typesSoFar())D(e.typeCache,r,(()=>new Set)).add(t);return n.values()}typesItCouldEmit(){const e=this.rhs.possibleEmissions();if(e.couldChangeType||void 0===this.lhs.guaranteedType()){if(e.possibleTypes.size>0)return e.possibleTypes;throw new Error("Could not determine the emitted type of a rule because its right-hand side calls props() without calling typeIn().")}return new Set([this.lhs.guaranteedType()])}typesItCouldAdd(){const e=new Set(this.typesItCouldEmit());return e.delete(this.lhs.guaranteedType()),e}_typesFinalized(){const e=this;return function(){const t=new k,r=e.rhs.possibleEmissions();if(r.couldChangeType)for(let n of e.lhs.possibleTypeCombinations())for(let e of r.possibleTypes)if(!n.has(e)){t.extend(n);break}return t}().extend(super._typesFinalized())}}class pe extends me{results(e){return this.rhs.allCallback(z(this.rhs.callback,z((function(e){return e instanceof de?e:e.fnode}),this.lhs.fnodes(e))))}key(){return this.rhs.key}_typesFinalized(){return this.lhs.typesMentioned().extend(super._typesFinalized())}}class fe{constructor(e,t=[],r=[]){this._inRules=[],this._outRules=new Map,this._rulesThatCouldEmit=new Map,this._rulesThatCouldAdd=new Map,this._coeffs=new Map(t),this.biases=new Map(r);for(let t of e)if(t instanceof he){this._inRules.push(t);const e=t.typesItCouldEmit();for(let r of e)D(this._rulesThatCouldEmit,r,(()=>[])).push(t);for(let e of t.typesItCouldAdd())D(this._rulesThatCouldAdd,e,(()=>[])).push(t)}else{if(!(t instanceof pe))throw new Error(`This element of ruleset()'s first param wasn't a rule: ${t}`);this._outRules.set(t.key(),t)}}against(e){return new ge(e,this._inRules,this._outRules,this._rulesThatCouldEmit,this._rulesThatCouldAdd,this._coeffs,this.biases)}rules(){return Array.from([...this._inRules,...this._outRules.values()])}}class ge{constructor(e,t,r,n,i,a,s){this.doc=e,this._inRules=t,this._outRules=r,this._rulesThatCouldEmit=n,this._rulesThatCouldAdd=i,this._coeffs=a,this.biases=s,this._clearCaches(),this.elementCache=new WeakMap,this.doneRules=new Set}setCoeffsAndBiases(e,t=[]){this._coeffs=new Map(e),this.biases=new Map(t),this._clearCaches()}_clearCaches(){this.maxCache=new Map,this.typeCache=new Map}get(e){if("string"==typeof e){if(this._outRules.has(e))return Array.from(this._execute(this._outRules.get(e)));throw new Error(`There is no out() rule with key "${e}".`)}if(G(e))return this.fnodeForElement(e);if(void 0!==e.asLhs){const t=ce(e,ie(Symbol("outKey")));return Array.from(this._execute(t))}throw new Error("ruleset.get() expects a string, an expression like on the left-hand side of a rule, or a DOM node.")}weightedScore(e){let t=0;for(const[r,n]of e)t+=n*O(this._coeffs,r,(()=>1));return t}_prerequisitesTo(e,t=new Map){for(let r of e.prerequisites(this))if(!this.doneRules.has(r)){const n=t.has(r);D(t,r,(()=>[])).push(e),n||this._prerequisitesTo(r,t)}return t}_execute(e){const t=this._prerequisitesTo(e);let r,n;try{r=[e].concat(function(e,t){const r=[],n=new Set(e),i=new Set;function a(e){if(i.has(e))throw new R("The graph has a cycle.");if(n.has(e)){i.add(e);for(let r of t(e))a(r);i.delete(e),n.delete(e),r.push(e)}}for(;n.size>0;)a(U(n));return r}(t.keys(),(e=>t.get(e))))}catch(e){throw e instanceof R?new R("There is a cyclic dependency in the ruleset."):e}for(let e of H(r))n=e.results(this);return Array.from(n)}inwardRulesThatCouldEmit(e){return O(this._rulesThatCouldEmit,e,(()=>[]))}inwardRulesThatCouldAdd(e){return O(this._rulesThatCouldAdd,e,(()=>[]))}fnodeForElement(e){return D(this.elementCache,e,(()=>new de(e,this)))}}let ye={_propsFromForm:["action","autocomplete","ownerDocument"],createFromForm(e){if(!HTMLFormElement.isInstance(e))throw new Error("createFromForm: aForm must be a HTMLFormElement");let t={elements:[...e.elements],rootElement:e};for(let r of this._propsFromForm)t[r]=e[r];return this._addToJSONProperty(t),t},createFromField(e){if(!HTMLInputElement.isInstance(e)&&!HTMLSelectElement.isInstance(e)||!e.ownerDocument)throw new Error("createFromField requires a field in a document");let t=this.findRootForField(e);if(HTMLFormElement.isInstance(t))return this.createFromForm(t);let n=e.ownerDocument,i={action:n.baseURI,autocomplete:"on",ownerDocument:n,rootElement:t};return r.defineLazyGetter(i,"elements",(function(){let e=[];for(let t of this.rootElement.querySelectorAll("input, select"))t.form||e.push(t);return e})),this._addToJSONProperty(i),i},closestFormIgnoringShadowRoots(e){let t=e.closest("form"),r=e;for(;!t;){let e=r.getRootNode();if(!ShadowRoot.isInstance(e))break;let n=e.host;t=n.closest("form"),r=n}return t},findRootForField(e){return e.form||this.closestFormIgnoringShadowRoots(e)||e.ownerDocument.documentElement},_addToJSONProperty(e){function t(e){let t=e.id?"#"+e.id:"",r="";for(let t of e.classList)r+="."+t;return`<${e.nodeName+t+r}>`}Object.defineProperty(e,"toJSON",{value:()=>{let r={};for(let n of Object.keys(e)){let i=e[n],a=i;switch(n){case"elements":a=[];for(let e of i)a.push(t(e));break;case"ownerDocument":a={location:{href:i.location.href}};break;case"rootElement":a=t(i)}r[n]=a}return r}})}};const xe={EXCLUDED_TAGS:["SCRIPT","NOSCRIPT","OPTION","STYLE"],_mappedLabels:null,_unmappedLabelControls:null,_labelStrings:null,extractLabelStrings(e){if(this._labelStrings.has(e))return this._labelStrings.get(e);let t=[],r=e=>{if(!this.EXCLUDED_TAGS.includes(e.tagName))if(e.nodeType!=e.TEXT_NODE&&e.childNodes.length)for(let t of e.childNodes){let e=t.nodeType;e!=t.ELEMENT_NODE&&e!=t.TEXT_NODE||r(t)}else{let r=e.textContent.trim();r&&t.push(r)}};return r(e),this._labelStrings.set(e,t),t},generateLabelMap(e){this._mappedLabels=new Map,this._unmappedLabelControls=[],this._labelStrings=new WeakMap;for(let t of e.querySelectorAll("label")){let e,r=t.htmlFor;if(!r){if(e=t.control,!e)continue;r=e.id}if(r){let e=this._mappedLabels.get(r);e?e.push(t):this._mappedLabels.set(r,[t])}else this._unmappedLabelControls.push({label:t,control:e})}},clearLabelMap(){this._mappedLabels=null,this._unmappedLabelControls=null,this._labelStrings=null},findLabelElements(e){this._mappedLabels||this.generateLabelMap(e.ownerDocument);let t=e.id;return t?this._mappedLabels.get(t)||[]:this._unmappedLabelControls.filter((t=>t.control==e)).map((e=>e.label))}};function be(e){return function(e){return new q(e)}(e)}var Ee={RULES:{"cc-name":void 0,"cc-number":void 0,"cc-exp-month":void 0,"cc-exp-year":void 0,"cc-exp":void 0,"cc-type":void 0},RULE_SETS:[{"cc-name":"account.*holder.*name|^(kredit)?(karten|konto)inhaber|^(name).*karte|nom.*(titulaire|détenteur)|(titulaire|détenteur).*(carte)|titolare.*carta|cc-?name|card-?name|cardholder-?name|(^nom$)|card.?(?:holder|owner)|name.*(\\b)?on(\\b)?.*card|(?:card|cc).?name|cc.?full.?name|(?:card|cc).?owner|nombre.*tarjeta|nom.*carte|nome.*cart|名前|Имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名","cc-number":"(cc|kk)nr|(kredit)?(karten)(nummer|nr)|numero.*carta|(numero|número|numéro).*(carte)|cc-?number|cc-?num|card-?number|card-?num|cc-?no|card-?no|numero-?carte|num-?carte|cb-?num|(add)?(?:card|cc|acct).?(?:number|#|no|num)|カード番号|Номер.*карты|信用卡号|信用卡号码|信用卡卡號|카드","cc-exp":"mm\\s*(/|\\|-)\\s*(yy|jj|aa)|(month|mois)\\s*(/|\\|-|et)\\s*(year|année)|(^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$)|expir|exp.*date|^expfield$|ablaufdatum|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты","cc-exp-month":"(cc|kk)month|(^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$)|exp.*mo|ccmonth|cardmonth|addmonth|monat|月","cc-exp-year":"(cc|kk)year|(^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$)|(add)?year|jahr|年|有效期","cc-type":"type|Kartenmarke|(^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$)"}],_getRule(e){let t=[];this.RULE_SETS.forEach((r=>{r[e]&&t.push(`(${r[e]})`.normalize("NFKC"))}));const r=new RegExp(t.join("|"),"iu");return Object.defineProperty(this.RULES,e,{get:void 0}),Object.defineProperty(this.RULES,e,{value:r}),r},init(){Object.keys(this.RULES).forEach((e=>Object.defineProperty(this.RULES,e,{get:()=>Ee._getRule(e)})))}};Ee.init();const _e=/^mm$|\(mm\)/i,Se=/^(yy|yyyy)$|\(yy\)|\(yyyy\)/i,Fe=/month/i,Le=/year/i,Me=/mm\s*(\/|\\)\s*yy/i,Ce=/visa(-|\s)checkout/i,Ne=new RegExp(b.getSupportedNetworks().concat(Object.keys(y)).join("|"),"gui"),Ae=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yy(?:[^y]|$)/i,Re=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yyyy(?:[^y]|$)/i,we=/^dwfrm/i,ve=/bml/i,Ie=/^\{\{.*\}\}$/,Te=/first/i,$e=/last/i,De=/gift/i,Oe=/subscription/i;function ke(e,t){const r=function(e){return e.getAutocompleteInfo()}(e);return r.fieldName===t}function Ue(e){const t=ye.createFromField(e);return Array.from(t.elements).filter((e=>_.isCreditCardOrAddressFieldType(e)))}function Pe(e,t){const r=function(e){const t=Ue(e),r=t.indexOf(e);return t[r+1]}(e);return!!r&&t(r)}function ze(e,t){const r=function(e){const t=Ue(e),r=t.indexOf(e);return t[r-1]}(e);return!!r&&t(r)}function Ye(e){return Pe(e.element,(e=>ke(e,"cc-exp-year")))}function Ge(e){return ze(e.element,(e=>ke(e,"cc-exp-month")))}function He(e,t){for(const r of[e.id,e.name])if(t.test(r))return!0;return!1}function Ve(e){return{*[Symbol.iterator](){const t=xe.findLabelElements(e);for(let e of t)yield*xe.extractLabelStrings(e)}}}function Be(e,t){const r=Ve(e);for(const e of r)if(t.test(e))return!0;const n=e.parentElement;return!!n&&("TD"===n.tagName&&n.parentElement?t.test(n.parentElement.textContent):!("DD"!==n.tagName||!n.previousElementSibling)&&t.test(n.previousElementSibling.textContent))}function We(e,t){const r=e.previousElementSibling;if(null!==r&&"LABEL"===r.tagName)return t.test(r.textContent);const n=e.nextElementSibling;return null!==n&&"LABEL"===n.tagName&&t.test(n.textContent)}function je(e,t){const r=e.getAttribute("aria-label");return!!r&&t.test(r)}function Ke(e,t){const r=e.getAttribute("placeholder");return!!r&&t.test(r)}function qe(e,t){return Pe(e,(e=>He(e,t)))}function Je(e,t){return Pe(e,(e=>Be(e,t)))}function Xe(e,t){return Pe(e,(e=>Ke(e,t)))}function Ze(e,t){return Pe(e,(e=>je(e,t)))}function Qe(e,t){return ze(e,(e=>He(e,t)))}function et(e,t){return ze(e,(e=>Be(e,t)))}function tt(e,t){return ze(e,(e=>Ke(e,t)))}function rt(e,t){return ze(e,(e=>je(e,t)))}function nt(e){const t=e.element;if("SELECT"===t.tagName)for(let e of t.querySelectorAll("option"))if(b.getNetworkFromName(e.value)||b.getNetworkFromName(e.text))return!0;return!1}function it(e){const t=e.element,r=t.type;if(r&&"radio"===r){const e=t.value.match(Ne);if(e)return 1===e.length;const r=Ve(t);let n=0;for(const e of r){const t=e.match(Ne);if(t){if(t.length>1)return!1;n++}}if(n>0)return 1===n;const i=t.textContent.match(Ne);if(i)return 1===i.length}return!1}function at(e,t){return e.some(((r,n)=>t.every(((t,r)=>t===e[n+r]))))}function st(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(at(t.map((e=>+e.value)),r)||at(t.map((e=>+e.label)),r))}function lt(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=(new Date).getFullYear(),n=Array(3).fill(0).map(((e,t)=>e+r+t));return at(t.map((e=>+e.value)),n)||at(t.map((e=>+e.label)),n)}function ot(e){return Pe(e.element,lt)}function dt(e){return ze(e.element,st)}function ct(e,t){const r=e.element;return t(r,Ae)||t(r,Re)}function ut(e,t){return e.element.maxLength===t}function mt(e){const t=e.element.getAttribute("role");return!!t&&"menu"===t}function ht(e){return He(e.element,we)&&He(e.element,ve)}function pt(e){const t=e.element.getAttribute("value");return!!t&&Ie.test(t)}function ft(e){const t=e.element.type;return!!t&&!["text","tel","number"].includes(t)}function gt(e){return He(e.element,Te)&&He(e.element,$e)}function*yt(e,t){for(const[n,i]of Object.entries(t))yield ce(le(e),(r=i,new oe({method:"score",args:[r]})),{name:n});var r}function xt(e,t){return function(e,t=[],r=[]){return new fe(e,t,r)}([ce(be("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=month], select, button"),le("typicalCandidates")),ce(le("typicalCandidates"),le("cc-number")),...yt("cc-number",{idOrNameMatchNumberRegExp:e=>He(e.element,Ee.RULES["cc-number"]),labelsMatchNumberRegExp:e=>Be(e.element,Ee.RULES["cc-number"]),closestLabelMatchesNumberRegExp:e=>We(e.element,Ee.RULES["cc-number"]),placeholderMatchesNumberRegExp:e=>Ke(e.element,Ee.RULES["cc-number"]),ariaLabelMatchesNumberRegExp:e=>je(e.element,Ee.RULES["cc-number"]),idOrNameMatchGift:e=>He(e.element,De),labelsMatchGift:e=>Be(e.element,De),placeholderMatchesGift:e=>Ke(e.element,De),ariaLabelMatchesGift:e=>je(e.element,De),idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt,inputTypeNotNumbery:ft}),ce(le("cc-number"),ie("cc-number")),ce(le("typicalCandidates"),le("cc-name")),...yt("cc-name",{idOrNameMatchNameRegExp:e=>He(e.element,Ee.RULES["cc-name"]),labelsMatchNameRegExp:e=>Be(e.element,Ee.RULES["cc-name"]),closestLabelMatchesNameRegExp:e=>We(e.element,Ee.RULES["cc-name"]),placeholderMatchesNameRegExp:e=>Ke(e.element,Ee.RULES["cc-name"]),ariaLabelMatchesNameRegExp:e=>je(e.element,Ee.RULES["cc-name"]),idOrNameMatchFirst:e=>He(e.element,Te),labelsMatchFirst:e=>Be(e.element,Te),placeholderMatchesFirst:e=>Ke(e.element,Te),ariaLabelMatchesFirst:e=>je(e.element,Te),idOrNameMatchLast:e=>He(e.element,$e),labelsMatchLast:e=>Be(e.element,$e),placeholderMatchesLast:e=>Ke(e.element,$e),ariaLabelMatchesLast:e=>je(e.element,$e),idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchFirstAndLast:gt,idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt}),ce(le("cc-name"),ie("cc-name")),ce(be("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=radio], select, button"),le("cc-type")),...yt("cc-type",{idOrNameMatchTypeRegExp:e=>He(e.element,Ee.RULES["cc-type"]),labelsMatchTypeRegExp:e=>Be(e.element,Ee.RULES["cc-type"]),closestLabelMatchesTypeRegExp:e=>We(e.element,Ee.RULES["cc-type"]),idOrNameMatchVisaCheckout:e=>He(e.element,Ce),ariaLabelMatchesVisaCheckout:e=>je(e.element,Ce),isSelectWithCreditCardOptions:nt,isRadioWithCreditCardText:it,idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt}),ce(le("cc-type"),ie("cc-type")),ce(le("typicalCandidates"),le("cc-exp")),...yt("cc-exp",{labelsMatchExpRegExp:e=>Be(e.element,Ee.RULES["cc-exp"]),closestLabelMatchesExpRegExp:e=>We(e.element,Ee.RULES["cc-exp"]),placeholderMatchesExpRegExp:e=>Ke(e.element,Ee.RULES["cc-exp"]),labelsMatchExpWith2Or4DigitYear:e=>ct(e,Be),placeholderMatchesExpWith2Or4DigitYear:e=>ct(e,Ke),labelsMatchMMYY:e=>Be(e.element,Me),placeholderMatchesMMYY:e=>Ke(e.element,Me),maxLengthIs7:e=>ut(e,7),idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt,isExpirationMonthLikely:e=>st(e.element),isExpirationYearLikely:e=>lt(e.element),idOrNameMatchMonth:e=>He(e.element,Fe),idOrNameMatchYear:e=>He(e.element,Le),idOrNameMatchExpMonthRegExp:e=>He(e.element,Ee.RULES["cc-exp-month"]),idOrNameMatchExpYearRegExp:e=>He(e.element,Ee.RULES["cc-exp-year"]),idOrNameMatchValidation:e=>He(e.element,/validate|validation/i)}),ce(le("cc-exp"),ie("cc-exp")),ce(le("typicalCandidates"),le("cc-exp-month")),...yt("cc-exp-month",{idOrNameMatchExpMonthRegExp:e=>He(e.element,Ee.RULES["cc-exp-month"]),labelsMatchExpMonthRegExp:e=>Be(e.element,Ee.RULES["cc-exp-month"]),closestLabelMatchesExpMonthRegExp:e=>We(e.element,Ee.RULES["cc-exp-month"]),placeholderMatchesExpMonthRegExp:e=>Ke(e.element,Ee.RULES["cc-exp-month"]),ariaLabelMatchesExpMonthRegExp:e=>je(e.element,Ee.RULES["cc-exp-month"]),idOrNameMatchMonth:e=>He(e.element,Fe),labelsMatchMonth:e=>Be(e.element,Fe),placeholderMatchesMonth:e=>Ke(e.element,Fe),ariaLabelMatchesMonth:e=>je(e.element,Fe),nextFieldIdOrNameMatchExpYearRegExp:e=>qe(e.element,Ee.RULES["cc-exp-year"]),nextFieldLabelsMatchExpYearRegExp:e=>Je(e.element,Ee.RULES["cc-exp-year"]),nextFieldPlaceholderMatchExpYearRegExp:e=>Xe(e.element,Ee.RULES["cc-exp-year"]),nextFieldAriaLabelMatchExpYearRegExp:e=>Ze(e.element,Ee.RULES["cc-exp-year"]),nextFieldIdOrNameMatchYear:e=>qe(e.element,Le),nextFieldLabelsMatchYear:e=>Je(e.element,Le),nextFieldPlaceholderMatchesYear:e=>Xe(e.element,Le),nextFieldAriaLabelMatchesYear:e=>Ze(e.element,Le),nextFieldMatchesExpYearAutocomplete:Ye,isExpirationMonthLikely:e=>st(e.element),nextFieldIsExpirationYearLikely:ot,maxLengthIs2:e=>ut(e,2),placeholderMatchesMM:e=>Ke(e.element,_e),roleIsMenu:mt,idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt}),ce(le("cc-exp-month"),ie("cc-exp-month")),ce(le("typicalCandidates"),le("cc-exp-year")),...yt("cc-exp-year",{idOrNameMatchExpYearRegExp:e=>He(e.element,Ee.RULES["cc-exp-year"]),labelsMatchExpYearRegExp:e=>Be(e.element,Ee.RULES["cc-exp-year"]),closestLabelMatchesExpYearRegExp:e=>We(e.element,Ee.RULES["cc-exp-year"]),placeholderMatchesExpYearRegExp:e=>Ke(e.element,Ee.RULES["cc-exp-year"]),ariaLabelMatchesExpYearRegExp:e=>je(e.element,Ee.RULES["cc-exp-year"]),idOrNameMatchYear:e=>He(e.element,Le),labelsMatchYear:e=>Be(e.element,Le),placeholderMatchesYear:e=>Ke(e.element,Le),ariaLabelMatchesYear:e=>je(e.element,Le),previousFieldIdOrNameMatchExpMonthRegExp:e=>Qe(e.element,Ee.RULES["cc-exp-month"]),previousFieldLabelsMatchExpMonthRegExp:e=>et(e.element,Ee.RULES["cc-exp-month"]),previousFieldPlaceholderMatchExpMonthRegExp:e=>tt(e.element,Ee.RULES["cc-exp-month"]),previousFieldAriaLabelMatchExpMonthRegExp:e=>rt(e.element,Ee.RULES["cc-exp-month"]),previousFieldIdOrNameMatchMonth:e=>Qe(e.element,Fe),previousFieldLabelsMatchMonth:e=>et(e.element,Fe),previousFieldPlaceholderMatchesMonth:e=>tt(e.element,Fe),previousFieldAriaLabelMatchesMonth:e=>rt(e.element,Fe),previousFieldMatchesExpMonthAutocomplete:Ge,isExpirationYearLikely:e=>lt(e.element),previousFieldIsExpirationMonthLikely:dt,placeholderMatchesYYOrYYYY:e=>Ke(e.element,Se),roleIsMenu:mt,idOrNameMatchSubscription:e=>He(e.element,Oe),idOrNameMatchDwfrmAndBml:ht,hasTemplatedValue:pt}),ce(le("cc-exp-year"),ie("cc-exp-year"))],e,t)}const bt={"cc-number":[["idOrNameMatchNumberRegExp",7.679469585418701],["labelsMatchNumberRegExp",5.122580051422119],["closestLabelMatchesNumberRegExp",2.1256935596466064],["placeholderMatchesNumberRegExp",9.471800804138184],["ariaLabelMatchesNumberRegExp",6.067715644836426],["idOrNameMatchGift",-22.946273803710938],["labelsMatchGift",-7.852959632873535],["placeholderMatchesGift",-2.355496406555176],["ariaLabelMatchesGift",-2.940307855606079],["idOrNameMatchSubscription",.11255314946174622],["idOrNameMatchDwfrmAndBml",-.0006645023822784424],["hasTemplatedValue",-.11370040476322174],["inputTypeNotNumbery",-3.750155210494995]],"cc-name":[["idOrNameMatchNameRegExp",7.496212959289551],["labelsMatchNameRegExp",6.081472873687744],["closestLabelMatchesNameRegExp",2.600574254989624],["placeholderMatchesNameRegExp",5.750874042510986],["ariaLabelMatchesNameRegExp",5.162227153778076],["idOrNameMatchFirst",-6.742659091949463],["labelsMatchFirst",-.5234538912773132],["placeholderMatchesFirst",-3.4615235328674316],["ariaLabelMatchesFirst",-1.3145145177841187],["idOrNameMatchLast",-12.561869621276855],["labelsMatchLast",-.27417105436325073],["placeholderMatchesLast",-1.434966802597046],["ariaLabelMatchesLast",-2.9319725036621094],["idOrNameMatchFirstAndLast",24.123435974121094],["idOrNameMatchSubscription",.08349418640136719],["idOrNameMatchDwfrmAndBml",.01882520318031311],["hasTemplatedValue",.182317852973938]],"cc-type":[["idOrNameMatchTypeRegExp",2.0581533908843994],["labelsMatchTypeRegExp",1.0784518718719482],["closestLabelMatchesTypeRegExp",.6995877623558044],["idOrNameMatchVisaCheckout",-3.320356845855713],["ariaLabelMatchesVisaCheckout",-3.4196767807006836],["isSelectWithCreditCardOptions",10.337477684020996],["isRadioWithCreditCardText",4.530318737030029],["idOrNameMatchSubscription",-3.7206356525421143],["idOrNameMatchDwfrmAndBml",-.08782318234443665],["hasTemplatedValue",.1772511601448059]],"cc-exp":[["labelsMatchExpRegExp",7.588159561157227],["closestLabelMatchesExpRegExp",1.41484534740448],["placeholderMatchesExpRegExp",8.759064674377441],["labelsMatchExpWith2Or4DigitYear",-3.876218795776367],["placeholderMatchesExpWith2Or4DigitYear",2.8364884853363037],["labelsMatchMMYY",8.836017608642578],["placeholderMatchesMMYY",-.5231751799583435],["maxLengthIs7",1.3565447330474854],["idOrNameMatchSubscription",.1779913753271103],["idOrNameMatchDwfrmAndBml",.21037884056568146],["hasTemplatedValue",.14900512993335724],["isExpirationMonthLikely",-3.223409652709961],["isExpirationYearLikely",-2.536919593811035],["idOrNameMatchMonth",-3.6893014907836914],["idOrNameMatchYear",-3.108184337615967],["idOrNameMatchExpMonthRegExp",-2.264357089996338],["idOrNameMatchExpYearRegExp",-2.7957723140716553],["idOrNameMatchValidation",-2.29402756690979]],"cc-exp-month":[["idOrNameMatchExpMonthRegExp",.2787344455718994],["labelsMatchExpMonthRegExp",1.298413634300232],["closestLabelMatchesExpMonthRegExp",-11.206244468688965],["placeholderMatchesExpMonthRegExp",1.2605619430541992],["ariaLabelMatchesExpMonthRegExp",1.1330018043518066],["idOrNameMatchMonth",6.1464314460754395],["labelsMatchMonth",.7051732540130615],["placeholderMatchesMonth",.7463492751121521],["ariaLabelMatchesMonth",1.8244760036468506],["nextFieldIdOrNameMatchExpYearRegExp",.06347066164016724],["nextFieldLabelsMatchExpYearRegExp",-.1692247837781906],["nextFieldPlaceholderMatchExpYearRegExp",1.0434566736221313],["nextFieldAriaLabelMatchExpYearRegExp",1.751156210899353],["nextFieldIdOrNameMatchYear",-.532447338104248],["nextFieldLabelsMatchYear",1.3248541355133057],["nextFieldPlaceholderMatchesYear",.604235827922821],["nextFieldAriaLabelMatchesYear",1.5364223718643188],["nextFieldMatchesExpYearAutocomplete",6.285938262939453],["isExpirationMonthLikely",13.117807388305664],["nextFieldIsExpirationYearLikely",7.182341575622559],["maxLengthIs2",4.477289199829102],["placeholderMatchesMM",14.403288841247559],["roleIsMenu",5.770959854125977],["idOrNameMatchSubscription",-.043085768818855286],["idOrNameMatchDwfrmAndBml",.02823038399219513],["hasTemplatedValue",.07234494388103485]],"cc-exp-year":[["idOrNameMatchExpYearRegExp",5.426016807556152],["labelsMatchExpYearRegExp",1.3240209817886353],["closestLabelMatchesExpYearRegExp",-8.702284812927246],["placeholderMatchesExpYearRegExp",.9059725999832153],["ariaLabelMatchesExpYearRegExp",.5550334453582764],["idOrNameMatchYear",5.362994194030762],["labelsMatchYear",2.7185044288635254],["placeholderMatchesYear",.7883157134056091],["ariaLabelMatchesYear",.311492383480072],["previousFieldIdOrNameMatchExpMonthRegExp",1.8155208826065063],["previousFieldLabelsMatchExpMonthRegExp",-.46133187413215637],["previousFieldPlaceholderMatchExpMonthRegExp",1.0374903678894043],["previousFieldAriaLabelMatchExpMonthRegExp",-.5901495814323425],["previousFieldIdOrNameMatchMonth",-5.960310935974121],["previousFieldLabelsMatchMonth",.6495584845542908],["previousFieldPlaceholderMatchesMonth",.7198042273521423],["previousFieldAriaLabelMatchesMonth",3.4590985774993896],["previousFieldMatchesExpMonthAutocomplete",2.986003875732422],["isExpirationYearLikely",4.021566390991211],["previousFieldIsExpirationMonthLikely",9.298635482788086],["placeholderMatchesYYOrYYYY",10.457176208496094],["roleIsMenu",1.1051956415176392],["idOrNameMatchSubscription",.000688597559928894],["idOrNameMatchDwfrmAndBml",.15687309205532074],["hasTemplatedValue",-.19141331315040588]]},Et=[["cc-number",-4.948795795440674],["cc-name",-5.3578081130981445],["cc-type",-5.979659557342529],["cc-exp",-5.849575996398926],["cc-exp-month",-8.844199180603027],["cc-exp-year",-6.499860763549805]];var _t={init(){r.defineLazyPreferenceGetter(this,"supportedTypes","extensions.formautofill.creditCards.heuristics.fathom.types",null,null,(e=>e.split(",")));for(const e of this.types)this[e]=xt([...bt[e]],Et)},get types(){return this.supportedTypes}};_t.init();const St="-moz-section-default",Ft=["address-level3","address-level2","address-level1","tel","postal-code","email","street-address"],Lt={"cc-number":4};class Mt{elementWeakRef=null;fieldName=null;reason=null;section="";addressType="";contactType="";part=null;confidence=null;constructor(e,t,{autocompleteInfo:r={},confidence:n=null}){this.elementWeakRef=Cu.getWeakReference(e),this.fieldName=t,r?(this.reason="autocomplete",this.section=r.section,this.addressType=r.addressType,this.contactType=r.contactType):n?(this.reason="fathom",this.confidence=n):this.reason="regex-heuristic"}isSame(e){return this.fieldName==e.fieldName&&this.section==e.section&&this.addressType==e.addressType&&!this.part&&!e.part}}class Ct{#t=null;#r=0;#n=[];fieldDetails=[];constructor(e){this.#t=Cu.getWeakReference(e),r.defineLazyGetter(this,"log",(()=>f.defineLogGetter(this,"FieldScanner")))}get#i(){return this.#t.get()}get parsingIndex(){return this.#r}set parsingIndex(e){if(e>this.#i.length)throw new Error("The parsing index is out of range.");this.#r=e}getFieldDetailByIndex(e){if(e>=this.#i.length)throw new Error(`The index ${e} is out of range.(${this.#i.length})`);if(e<this.fieldDetails.length)return this.fieldDetails[e];for(let t=this.fieldDetails.length;t<e+1;t++)this.pushDetail();return this.fieldDetails[e]}get parsingFinished(){return this.parsingIndex>=this.#i.length}#a(e,t){const r=this.#n.find((t=>t.name==e));r?r.fieldDetails.push(t):this.#n.push({name:e,fieldDetails:[t]})}#s(e,t,r,n,i){if(e)e--;else{const a=Lt[t]-2,s=r.slice(n+1,n+1+a);s.length==a&&s.every((e=>e.fieldName==t))?e=a:i=!0}return{mergeNextNFields:e,createNewSection:i}}#l(){const e=this.#n[0].fieldDetails;this.#n=[];let t,r=new Set,n=0,i=0;for(let a=0;a<e.length;a++){let s=e[a].fieldName;if(!s)continue;let l=!1;r.has(s)&&(t!=s?l=!0:Ft.includes(s)||(s in Lt?({mergeNextNFields:i,createNewSection:l}=this.#s(i,s,e,a,l)):l=!0)),l&&(i=0,r.clear(),n++),t=s,r.add(s),this.#a("-moz-section-default-"+n,e[a])}}getSectionFieldDetails(){return this.#n.length?(1==this.#n.length&&this.#n[0].name==St&&this.#l(),this.#n.reduce(((e,t)=>(e.push(...this.#o(t.fieldDetails)),e)),[])):[]}pushDetail(){const e=this.fieldDetails.length;if(e>=this.#i.length)throw new Error("Try to push the non-existing element info.");const t=this.#i[e],[r,n,i]=At.getInferredInfo(t,this),a=new Mt(t,r,{autocompleteInfo:n,confidence:i});this.fieldDetails.push(a),this.#a(this.#d(a),a)}#d(e){let t=[];return e.section&&t.push(e.section),e.addressType&&t.push(e.addressType),t.length?t.join(" "):St}updateFieldName(e,t){if(e>=this.fieldDetails.length)throw new Error("Try to update the non-existing field detail.");this.fieldDetails[e].fieldName=t}#c(e){const t=e.filter((e=>"cc-number"==e.fieldName&&4==e.elementWeakRef.get().maxLength));4==t.length&&t.map(((e,t)=>{e.part=t+1}))}#o(e){let t=[],r=[];for(const n of e){const e=n.fieldName;_.isAddressField(e)?t.push(n):_.isCreditCardField(e)?r.push(n):this.log.debug("Not collecting a field with a unknown fieldName",n)}return this.#c(r),[{type:_.SECTION_TYPES.ADDRESS,fieldDetails:t},{type:_.SECTION_TYPES.CREDIT_CARD,fieldDetails:r}].map((e=>{const t=e.fieldDetails;return e.fieldDetails=t.filter(((e,r)=>!t.slice(0,r).find((t=>t.isSame(e))))),e})).filter((e=>!!e.fieldDetails.length))}elementExisting(e){return e<this.#i.length}getFathomField(e,t){if(!t.length)return[null,null];if(!this._fathomConfidences?.get(e)){this._fathomConfidences=new Map;let t=[];t=this.#i?.includes(e)?this.#i:[e];const r=Ct.getFormAutofillConfidences(t);for(let e=0;e<t.length;e++)this._fathomConfidences.set(t[e],r[e])}const r=this._fathomConfidences.get(e);if(!r)return[null,null];let n=null,i=_.ccFathomConfidenceThreshold;for(let[e,a]of Object.entries(r))t.includes(e)&&a>i&&(i=a,n=e);return n?(_.ccFathomTestConfidence>0&&(i=_.ccFathomTestConfidence),[n,i]):[null,null]}static getFormAutofillConfidences(e){return _.ccHeuristicsMode==_.CC_FATHOM_NATIVE?ChromeUtils.getFormAutofillConfidences(e).map((e=>{let t={};for(let[r,n]of Object.entries(e))t[_.formAutofillConfidencesKeyToCCFieldType(r)]=n;return t})):e.map((e=>{const t={};return _t.types.map((r=>{t[r]=function(t){const r=_t[t].against(e).get(t);return r.length?r[0].scoreFor(t):0}(r)})),t}))}}const Nt={RULES:{email:void 0,tel:void 0,organization:void 0,"street-address":void 0,"address-line1":void 0,"address-line2":void 0,"address-line3":void 0,"address-level2":void 0,"address-level1":void 0,"postal-code":void 0,country:void 0,"cc-name":void 0,name:void 0,"given-name":void 0,"additional-name":void 0,"family-name":void 0,"cc-number":void 0,"cc-exp-month":void 0,"cc-exp-year":void 0,"cc-exp":void 0,"cc-type":void 0},RULE_SETS:[{"address-line1":"addrline1|address_1","address-line2":"addrline2|address_2","address-line3":"addrline3|address_3","address-level1":"land","additional-name":"apellido.?materno|lastlastname","cc-name":"accountholdername|titulaire","cc-number":"(cc|kk)nr","cc-exp-month":"month|(cc|kk)month","cc-exp-year":"year|(cc|kk)year","cc-type":"type|kartenmarke"},{email:"(^e-?mail$)|(^email-?address$)",tel:"(^phone$)|(^mobile$)|(^mobile-?phone$)|(^tel$)|(^telephone$)|(^phone-?number$)",organization:"(^company$)|(^company-?name$)|(^organization$)|(^organization-?name$)","street-address":"(^address$)|(^street-?address$)|(^addr$)|(^street$)|(^mailing-?addr(ess)?$)|(^billing-?addr(ess)?$)|(^mail-?addr(ess)?$)|(^bill-?addr(ess)?$)","address-line1":"(^address-?1$)|(^address-?line-?1$)|(^addr-?1$)|(^street-?1$)","address-line2":"(^address-?2$)|(^address-?line-?2$)|(^addr-?2$)|(^street-?2$)","address-line3":"(^address-?3$)|(^address-?line-?3$)|(^addr-?3$)|(^street-?3$)","address-level2":"(^city$)|(^town$)|(^address-?level-?2$)|(^address-?city$)|(^address-?town$)","address-level1":"(^state$)|(^province$)|(^provence$)|(^address-?level-?1$)|(^address-?state$)|(^address-?province$)","postal-code":"(^postal$)|(^zip$)|(^zip2$)|(^zip-?code$)|(^postal-?code$)|(^post-?code$)|(^address-?zip$)|(^address-?postal$)|(^address-?code$)|(^address-?postal-?code$)|(^address-?zip-?code$)",country:"(^country$)|(^country-?code$)|(^country-?name$)|(^address-?country$)|(^address-?country-?name$)|(^address-?country-?code$)",name:"(^name$)|full-?name|your-?name","given-name":"(^f-?name$)|(^first-?name$)|(^given-?name$)|(^first-?n$)","additional-name":"(^m-?name$)|(^middle-?name$)|(^additional-?name$)|(^middle-?initial$)|(^middle-?n$)|(^middle-?i$)","family-name":"(^l-?name$)|(^last-?name$)|(^s-?name$)|(^surname$)|(^family-?name$)|(^family-?n$)|(^last-?n$)","cc-name":"cc-?name|card-?name|cardholder-?name|cardholder|(^nom$)","cc-number":"cc-?number|cc-?num|card-?number|card-?num|(^number$)|(^cc$)|cc-?no|card-?no|(^credit-?card$)|numero-?carte|(^carte$)|(^carte-?credit$)|num-?carte|cb-?num","cc-exp":"(^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$)","cc-exp-month":"(^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$)","cc-exp-year":"(^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$)","cc-type":"(^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$)"},{email:"e.?mail|courriel|correo.*electr(o|ó)nico|メールアドレス|Электронной.?Почты|邮件|邮箱|電郵地址|ഇ-മെയില്‍|ഇലക്ട്രോണിക്.?മെയിൽ|ایمیل|پست.*الکترونیک|ईमेल|इलॅक्ट्रॉनिक.?मेल|(\\b|_)eposta(\\b|_)|(?:이메일|전자.?우편|[Ee]-?mail)(.?주소)?",tel:"phone|mobile|contact.?number|telefonnummer|telefono|teléfono|telfixe|電話|telefone|telemovel|телефон|मोबाइल|(\\b|_|\\*)telefon(\\b|_|\\*)|电话|മൊബൈല്‍|(?:전화|핸드폰|휴대폰|휴대전화)(?:.?번호)?",organization:"company|business|organization|organisation|(?<neg>confirma)|firma|firmenname|empresa|societe|société|ragione.?sociale|会社|название.?компании|单位|公司|شرکت|회사|직장","street-address":"streetaddress|street-address","address-line1":"^address$|address[_-]?line(one)?|address1|addr1|street|(?:shipping|billing)address$|strasse|straße|hausnummer|housenumber|house.?name|direccion|dirección|adresse|indirizzo|^住所$|住所1|morada|(?<neg>identificação do endereço)|(endereço)|Адрес|地址|(\\b|_)adres(?! (başlığı(nız)?|tarifi))(\\b|_)|^주소.?$|주소.?1","address-line2":"address[_-]?line(2|two)|address2|addr2|street|suite|unit(?!e)|adresszusatz|ergänzende.?angaben|direccion2|colonia|adicional|addresssuppl|complementnom|appartement|indirizzo2|住所2|complemento|addrcomplement|Улица|地址2|주소.?2","address-line3":"address[_-]?line(3|three)|address3|addr3|street|suite|unit(?!e)|adresszusatz|ergänzende.?angaben|direccion3|colonia|adicional|addresssuppl|complementnom|appartement|indirizzo3|住所3|complemento|addrcomplement|Улица|地址3|주소.?3","address-level2":"city|town|\\bort\\b|stadt|suburb|ciudad|provincia|localidad|poblacion|ville|commune|localita|市区町村|cidade|Город|市|分區|شهر|शहर|ग्राम|गाँव|നഗരം|ഗ്രാമം|((\\b|_|\\*)([İii̇]l[cç]e(miz|niz)?)(\\b|_|\\*))|^시[^도·・]|시[·・]?군[·・]?구","address-level1":"(?<neg>united?.state|hist?.state|history?.state)|state|county|region|province|principality|都道府県|estado|provincia|область|省|地區|സംസ്ഥാനം|استان|राज्य|((\\b|_|\\*)(eyalet|[şs]ehir|[İii̇]l(imiz)?|kent)(\\b|_|\\*))|^시[·・]?도","postal-code":"zip|postal|post.*code|pcode|pin.?code|postleitzahl|\\bcp\\b|\\bcdp\\b|\\bcap\\b|郵便番号|codigo|codpos|\\bcep\\b|Почтовый.?Индекс|पिन.?कोड|പിന്‍കോഡ്|邮政编码|邮编|郵遞區號|(\\b|_)posta kodu(\\b|_)|우편.?번호",country:"country|countries|país|pais|(\\b|_)land(\\b|_)(?!.*(mark.*))|(?<neg>入国|出国)|国|国家|국가|나라|(\\b|_)(ülke|ulce|ulke)(\\b|_)|کشور","cc-name":"card.?(?:holder|owner)|name.*(\\b)?on(\\b)?.*card|(?:card|cc).?name|cc.?full.?name|karteninhaber|nombre.*tarjeta|nom.*carte|nome.*cart|名前|Имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名",name:"^name|full.?name|your.?name|customer.?name|bill.?name|ship.?name|name.*first.*last|firstandlastname|nombre.*y.*apellidos|^nom(?!bre)|お名前|氏名|^nome|نام.*نام.*خانوادگی|姓名|(\\b|_|\\*)ad[ı]? soyad[ı]?(\\b|_|\\*)|성명","given-name":"first.*name|initials|fname|first$|given.*name|vorname|nombre|forename|prénom|prenom|名|nome|Имя|نام|이름|പേര്|(\\b|_|\\*)(isim|ad|ad(i|ı|iniz|ınız)?)(\\b|_|\\*)|नाम","additional-name":"middle.*name|mname|middle$|middle.*initial|m\\.i\\.|mi$|\\bmi\\b","family-name":"last.*name|lname|surname|last$|secondname|family.*name|nachname|apellidos?|famille|^nom(?!bre)|cognome|姓|apelidos|surename|sobrenome|Фамилия|نام.*خانوادگی|उपनाम|മറുപേര്|(\\b|_|\\*)(soyisim|soyad(i|ı|iniz|ınız)?)(\\b|_|\\*)|\\b성(?:[^명]|\\b)","cc-number":"(add)?(?:card|cc|acct).?(?:number|#|no|num|field)|(?<neg>telefonnummer|hausnummer|personnummer|fødselsnummer)|nummer|カード番号|Номер.*карты|信用卡号|信用卡号码|信用卡卡號|카드|(numero|número|numéro)(?!.*(document|fono|phone|réservation))","cc-exp-month":"expir|exp.*mo|exp.*date|ccmonth|cardmonth|addmonth|gueltig|gültig|monat|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты|月","cc-exp-year":"exp|^/|(add)?year|ablaufdatum|gueltig|gültig|jahr|fecha|scadenza|有効期限|validade|Срок действия карты|年|有效期","cc-exp":"expir|exp.*date|^expfield$|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты"}],_getRule(e){let t=[];this.RULE_SETS.forEach((r=>{r[e]&&t.push(`(${r[e].toLowerCase()})`.normalize("NFKC"))}));const r=new RegExp(t.join("|"),"gu");return Object.defineProperty(this.RULES,e,{get:void 0}),Object.defineProperty(this.RULES,e,{value:r}),r},getRules(){return Object.keys(this.RULES).forEach((e=>Object.defineProperty(this.RULES,e,{get:()=>Nt._getRule(e)}))),this.RULES}},At={RULES:Nt.getRules(),CREDIT_CARD_FIELDNAMES:[],ADDRESS_FIELDNAMES:[],_matchContiguousSubArray:(e,t)=>e.some(((r,n)=>t.every(((t,r)=>t==e[n+r])))),_isExpirationMonthLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(this._matchContiguousSubArray(t.map((e=>+e.value)),r)||this._matchContiguousSubArray(t.map((e=>+e.label)),r))},_isExpirationYearLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=(new Date).getFullYear(),n=Array(3).fill(0).map(((e,t)=>e+r+t));return this._matchContiguousSubArray(t.map((e=>+e.value)),n)||this._matchContiguousSubArray(t.map((e=>+e.label)),n)},_parsePhoneFields(e){let t;const r=this.PHONE_FIELD_GRAMMARS;for(let n=0;n<r.length;n++){let i=e.parsingIndex,a=n;for(;n<r.length&&r[n][0]&&e.elementExisting(i);n++,i++){let t=e.getFieldDetailByIndex(i);if(!t||r[n][0]!=t.fieldName||"autocomplete"==t?.reason)break;let a=t.elementWeakRef.get();if(!a)break;if(r[n][2]&&(!a.maxLength||r[n][2]<a.maxLength))break}if(n>=r.length)break;if(!r[n][0]){t={ruleFrom:a,ruleTo:n};break}for(;n<r.length&&r[n][0];n++);}let n=!1;if(t){let{ruleFrom:i,ruleTo:a}=t,s=e.parsingIndex;for(let t=i;t<a;t++)e.updateFieldName(s,r[t][1]),e.parsingIndex++,s++,n=!0}if(e.parsingFinished)return n;let i=e.getFieldDetailByIndex(e.parsingIndex);if(i&&"autocomplete"!=i.reason&&e.parsingIndex>0){const t=new RegExp("\\bext|ext\\b|extension|ramal","iu"),r=e.getFieldDetailByIndex(e.parsingIndex-1),a=_.getCategoryFromFieldName(r.fieldName);r&&"tel"==a&&this._matchRegexp(i.elementWeakRef.get(),t)&&(e.updateFieldName(e.parsingIndex,"tel-extension"),e.parsingIndex++,n=!0)}return n},_parseAddressFields(e){let t=!1;const r=["address-line1","address-line2","address-line3"],n={"address-line1":new RegExp("address[_-]?line(1|one)|address1|addr1|addrline1|address_1|indirizzo1|住所1|地址1|주소.?1","iu"),"address-line2":new RegExp("address[_-]?line(2|two)|address2|addr2|addrline2|address_2|indirizzo2|住所2|地址2|주소.?2","iu"),"address-line3":new RegExp("address[_-]?line(3|three)|address3|addr3|addrline3|address_3|indirizzo3|住所3|地址3|주소.?3","iu")};for(;!e.parsingFinished;){let i=e.getFieldDetailByIndex(e.parsingIndex);if(!i||!r.includes(i.fieldName)||"autocomplete"==i.reason)break;const a=i.elementWeakRef.get();for(let r of Object.keys(n))this._matchRegexp(a,n[r])&&(e.updateFieldName(e.parsingIndex,r),t=!0);e.parsingIndex++}return t},_parseCreditCardFields(e){if(e.parsingFinished)return!1;const t=e.parsingIndex,r=e.getFieldDetailByIndex(e.parsingIndex);if(!r||"autocomplete"==r?.reason)return!1;if(!["cc-exp","cc-type","cc-exp-month","cc-exp-year"].includes(r.fieldName))return!1;if(_.isFathomCreditCardsEnabled()&&_t.types.includes(r.fieldName))return e.parsingIndex++,!0;const n=r.elementWeakRef.get();if(HTMLSelectElement.isInstance(n))for(let t of n.querySelectorAll("option"))if(b.getNetworkFromName(t.value)||b.getNetworkFromName(t.text))return e.updateFieldName(e.parsingIndex,"cc-type"),e.parsingIndex++,!0;if("month"==n.type)return e.updateFieldName(e.parsingIndex,"cc-exp"),e.parsingIndex++,!0;if("cc-exp-month"==e.getFieldDetailByIndex(e.parsingIndex++).fieldName&&!e.parsingFinished&&"cc-exp-year"==e.getFieldDetailByIndex(e.parsingIndex++).fieldName)return!0;if(e.parsingIndex=t,this._isExpirationMonthLikely(n)&&(e.updateFieldName(e.parsingIndex,"cc-exp-month"),e.parsingIndex++,!e.parsingFinished)){const t=e.getFieldDetailByIndex(e.parsingIndex).elementWeakRef.get();if(this._isExpirationYearLikely(t))return e.updateFieldName(e.parsingIndex,"cc-exp-year"),e.parsingIndex++,!0}if(e.parsingIndex=t,this._findMatchedFieldName(n,["cc-exp-month"])&&(e.updateFieldName(e.parsingIndex,"cc-exp-month"),e.parsingIndex++,!e.parsingFinished)){const t=e.getFieldDetailByIndex(e.parsingIndex).elementWeakRef.get();if(this._findMatchedFieldName(t,["cc-exp-year"]))return e.updateFieldName(e.parsingIndex,"cc-exp-year"),e.parsingIndex++,!0}if(e.parsingIndex=t,this._matchRegexp(n,/^mm$/gi)&&(e.updateFieldName(e.parsingIndex,"cc-exp-month"),e.parsingIndex++,!e.parsingFinished)){const t=e.getFieldDetailByIndex(e.parsingIndex).elementWeakRef.get();if(this._matchRegexp(t,/^(yy|yyyy)$/))return e.updateFieldName(e.parsingIndex,"cc-exp-year"),e.parsingIndex++,!0}return e.parsingIndex=t,this._matchRegexp(n,/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yy(?:[^y]|$)/gi)||this._matchRegexp(n,/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yyyy(?:[^y]|$)/gi)?(e.updateFieldName(e.parsingIndex,"cc-exp"),e.parsingIndex++,!0):(e.parsingIndex=t,this._findMatchedFieldName(n,["cc-exp"])?(e.updateFieldName(e.parsingIndex,"cc-exp"),e.parsingIndex++,!0):(e.parsingIndex=t,e.updateFieldName(e.parsingIndex,null),e.parsingIndex++,!0))},getFormInfo(e){const t=Array.from(e.elements).filter((e=>_.isCreditCardOrAddressFieldType(e)));if(t.length<=0)return[];let r=new Ct(t);for(;!r.parsingFinished;){let e=this._parsePhoneFields(r),t=this._parseAddressFields(r),n=this._parseCreditCardFields(r);e||t||n||r.parsingIndex++}return xe.clearLabelMap(),r.getSectionFieldDetails()},_getPossibleFieldNames(e){let t=[];const r="off"==e.autocomplete||"off"==e.form?.autocomplete;if(!f.isAutofillCreditCardsAvailable||r&&!f.creditCardsAutocompleteOff||t.push(...this.CREDIT_CARD_FIELDNAMES),!f.isAutofillAddressesAvailable||r&&!f.addressesAutocompleteOff||t.push(...this.ADDRESS_FIELDNAMES),HTMLSelectElement.isInstance(e)){const e=["address-level1","address-level2","country","cc-exp-month","cc-exp-year","cc-exp","cc-type"];t=t.filter((t=>e.includes(t)))}return t},getInferredInfo(e,t){const r=e.getAutocompleteInfo();if(r?.fieldName&&!["on","off"].includes(r.fieldName))return[r.fieldName,r,null];const n=this._getPossibleFieldNames(e);if("email"==e.type&&n.includes("email"))return["email",null,null];if(_.isFathomCreditCardsEnabled()){const r=n.filter((e=>_t.types.includes(e))),[i,a]=t.getFathomField(e,r);if(i)return[i,null,a]}if(n.length){const t=this._findMatchedFieldName(e,n);if(t)return[t,null,null]}return[null,null,null]},_getElementStrings:e=>({*[Symbol.iterator](){yield e.id,yield e.name,yield e.placeholder?.trim();const t=xe.findLabelElements(e);for(let e of t)yield*xe.extractLabelStrings(e)}}),testRegex(e,t){const r=t?.matchAll(e);if(!r)return!1;const n=[];for(const e of r)n.push(...e.filter((t=>t!==e?.groups?.neg)).filter(Boolean));return n?.length>0},_findMatchedFieldName(e,t){const r=this._getElementStrings(e);for(let e of t)for(let t of r)if(this.testRegex(this.RULES[e],t?.toLowerCase()))return e;return null},_matchRegexp(e,t){const r=this._getElementStrings(e);for(const e of r)if(t.test(e))return!0;return!1},PHONE_FIELD_GRAMMARS:[["tel","tel-country-code",3],["tel","tel-area-code",3],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0],["tel","tel-area-code",0],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0]]};r.defineLazyGetter(At,"CREDIT_CARD_FIELDNAMES",(()=>Object.keys(At.RULES).filter((e=>_.isCreditCardField(e))))),r.defineLazyGetter(At,"ADDRESS_FIELDNAMES",(()=>Object.keys(At.RULES).filter((e=>_.isAddressField(e)))));const{FIELD_STATES:Rt}=_;class wt{window=null;winUtils=null;form=null;sections=[];#u=null;#m=new WeakMap;#h=new WeakMap;fieldDetails=null;constructor(e,t=(()=>{}),n=(()=>{})){this._updateForm(e),this.window=this.form.rootElement.ownerGlobal,this.winUtils=this.window.windowUtils,this.FIELD_STATE_ENUM={[Rt.NORMAL]:null,[Rt.AUTO_FILLED]:"autofill",[Rt.PREVIEW]:"-moz-autofill-preview"},this.onFormSubmitted=()=>{t(this.form,this.window,this)},this.onAutofillCallback=n,r.defineLazyGetter(this,"log",(()=>f.defineLogGetter(this,"FormAutofillHandler")))}handleEvent(e){if("input"===e.type){if(!e.isTrusted)return;const t=e.target,r=this.getFieldDetailByElement(t),n=_.isCreditCardField(r.fieldName);if(!HTMLSelectElement.isInstance(t)&&n&&""===t.value&&this.onAutofillCallback(),this.getFilledStateByElement(t)==Rt.NORMAL)return;this.changeFieldState(r,Rt.NORMAL),this.getSectionByElement(r.elementWeakRef.get())?.clearFilled(r)}}set focusedInput(e){const t=this.getSectionByElement(e);t&&(this.#u=t,this.#u.focusedInput=e)}getSectionByElement(e){const t=this.#m.get(e)??this.sections.find((t=>t.getFieldDetailByElement(e)));return t?(this.#m.set(e,t),t):null}getFieldDetailByElement(e){for(const t of this.sections){const r=t.getFieldDetailByElement(e);if(r)return r}return null}get activeSection(){return this.#u}updateFormIfNeeded(e){let t;const r=()=>(t||(t=ye.createFromField(e)),t);return(e.form??r()).elements.length!=this.form.elements.length?(this.log.debug("The count of form elements is changed."),this._updateForm(r()),!0):!this.form.elements.includes(e)&&(this.log.debug("The element can not be found in the current form."),this._updateForm(r()),!0)}_updateForm(e){this.form=e,this.fieldDetails=null,this.sections=[],this.#m=new WeakMap}collectFormFields(){const e=At.getFormInfo(this.form),t=[];for(const{fieldDetails:r,type:n}of e){let e;if(n==_.SECTION_TYPES.ADDRESS)e=new N(r,this,this.onAutofillCallback);else{if(n!=_.SECTION_TYPES.CREDIT_CARD)throw new Error("Unknown field type.");e=new A(r,this,this.onAutofillCallback)}this.sections.push(e),t.push(...e.fieldDetails)}return this.fieldDetails=t,t}#p(){return this.sections.some((e=>e.isFilled()))}getFilledStateByElement(e){return this.#h.get(e)}changeFieldState(e,t){const r=e.elementWeakRef.get();if(!r)return void this.log.warn(e.fieldName,"is unreachable while changing state");if(!(t in this.FIELD_STATE_ENUM))return void this.log.warn(e.fieldName,"is trying to change to an invalid state");if(this.#h.get(r)==t)return;let n=null;for(const[e,i]of Object.entries(this.FIELD_STATE_ENUM))i&&(e==t?n=i:this.winUtils.removeManuallyManagedState(r,i));n&&this.winUtils.addManuallyManagedState(r,n),t==Rt.AUTO_FILLED&&r.addEventListener("input",this,{mozSystemGroup:!0}),this.#h.set(r,t)}async autofillFormFields(e){const t=!this.#p();await this.activeSection.autofillFields(e);const r=e=>{e.isTrusted&&("reset"==e.type&&this.sections.map((e=>e.resetFieldStates())),this.#p()||(this.form.rootElement.removeEventListener("input",r,{mozSystemGroup:!0}),this.form.rootElement.removeEventListener("reset",r,{mozSystemGroup:!0})))};t&&(this.log.debug("register change handler for filled form:",this.form),this.form.rootElement.addEventListener("input",r,{mozSystemGroup:!0}),this.form.rootElement.addEventListener("reset",r,{mozSystemGroup:!0}))}createRecords(){const e={address:[],creditCard:[]};for(const t of this.sections){const r=t.createRecord();if(r)if(t instanceof N)e.address.push(r);else{if(!(t instanceof A))throw new Error("Unknown section type");e.creditCard.push(r)}}return e}}class vt{constructor(e,t){this._formsDetails=new WeakMap,this._activeItems={},this.onSubmit=e,this.onAutofillCallback=t}get activeFieldDetail(){if(!this._activeItems.fieldDetail){let e=this.activeFormDetails;if(!e)return null;for(let t of e){let e=t.elementWeakRef.get();if(e&&this.activeInput==e){this._activeItems.fieldDetail=t;break}}}return this._activeItems.fieldDetail}get activeFormDetails(){let e=this.activeHandler;return e?e.fieldDetails:null}get activeInput(){let e=this._activeItems.elementWeakRef;return e?e.get():null}get activeHandler(){const e=this.activeInput;if(!e)return null;let t=this._getFormHandler(e);return t&&(t.focusedInput=e),t}get activeSection(){let e=this.activeHandler;return e?e.activeSection:null}_getFormHandler(e){if(!e)return null;let t=ye.findRootForField(e);return this._formsDetails.get(t)}identifyAutofillFields(e){let t=this._getFormHandler(e);if(t){if(!t.updateFormIfNeeded(e))return t.fieldDetails}else{let r=ye.createFromField(e);t=new wt(r,this.onSubmit,this.onAutofillCallback)}return this._formsDetails.set(t.form.rootElement,t),t.collectFormFields()}updateActiveInput(e){this._activeItems=e?{elementWeakRef:Cu.getWeakReference(e),fieldDetail:null}:{}}getRecords(e,t){const r=(t=t||this._formsDetails.get(e))?.createRecords();return t&&r&&Object.values(r).some((e=>e.length))?r:null}}const It=e=>e,Tt=(e,t=It)=>r=>window.webkit.messageHandlers.creditCardMessageHandler?.postMessage({type:e,payload:t(r)}),$t=Tt("capture-credit-card-form"),Dt=Tt("fill-credit-card-form");Object.defineProperty(window.__firefox__,"CreditCardHelper",{enumerable:!1,configurable:!1,writable:!1,value:Object.freeze(new class{constructor(e,t){this.onFocusIn=this.onFocusIn.bind(this),this.onSubmit=this.onSubmit.bind(this),this.onSubmitCallback=e,this.onAutofillCallback=t,this.fieldDetailsManager=new vt,document.addEventListener("focusin",this.onFocusIn),document.addEventListener("submit",this.onSubmit)}_doIdentifyAutofillFields(e){this.fieldDetailsManager.updateActiveInput(e);const t=this.fieldDetailsManager.identifyAutofillFields(e);if(t?.find((t=>t.elementWeakRef.get()===e))){const e=t?.reduce(((e,t)=>({...e,[t.fieldName]:t.elementWeakRef.get().value})),{});this.onAutofillCallback(e)}}onFocusIn(e){const t=e.target;this.fieldDetailsManager.updateActiveInput(t),_.isCreditCardOrAddressFieldType(t)&&this._doIdentifyAutofillFields(t)}onSubmit(e){this.fieldDetailsManager.activeHandler.onFormSubmitted();const t=this.fieldDetailsManager.activeHandler.createRecords();t.creditCard&&this.onSubmitCallback(t.creditCard.map((e=>e.record)))}fillFormFields(e){this.fieldDetailsManager.activeHandler.autofillFormFields(e)}}($t,Dt))})})();